<html>
  <head>
    <style>
      body {margin: 0; padding: 5px; background-color: #ffffff}
      button {font: 12px sans-serif;}
      p {margin: 5px 0 5px 0}
      #hl {position: absolute; display: none; overflow: hidden; white-space: nowrap; pointer-events: none; background-color: #00000000; outline: 0.5px solid #222; height: 15px}
      #hl span {padding: 0 3px 0 3px}
      #status {overflow: hidden; white-space: nowrap}
      #match {overflow: hidden; white-space: nowrap; display: none; float: right; text-align: right}
      * {box-sizing:border-box,margin:.25em 0}
      .col{display:table-cell}
      .col-1{width:5%}
      .col-2{width:15%}
      .col-3{width:22%}
      .col-4{width:30%}
      .col-5{width:40%}
      .col-6{width:50%}
      .row{display:table;border-spacing:0.2em 0;width:100%;display:flex}
      .w-100{width:100%;display:flex}
      .graphCol{flex: 80%; padding: 0.25em;}
      .configCol{flex: 20%; padding: 0.25em;}
      .configBlock{position:fixed; overflow-y:auto; top: 5px; bottom: 5px; width:19%;}
      .sidebarToggle{font: 10px; width:10; padding:0;}
      .margins {margin: 5px 1px}
      .vmargins {margin: 0px 1px;}
      .context {display: inline-block; position:fixed; top:0px; left:0px; min-width:200px;
                color:#fff;  background:#262933; font-size:9pt; border:1px solid #333333;
                border-radius:6px; box-shadow:2px 2px 2px -1px rgba(0, 0, 0, 0.5);
                padding:3px 0px; -webkit-touch-callout:none; -webkit-user-select:none;
                -khtml-user-select:none; -moz-user-select:none; -ms-user-select:none;
                user-select:none; z-index:200;}
      .context .item {padding:4px 19px; cursor:default; color:inherit;}
      .context .item:hover { background:#2777FF;}
      .context .item:hover .hotkey {color: #fff;}
      .context .disabled {color:#878B90;}
      .context .disabled:hover {background:inherit;}
      .context .disabled:hover .hotkey {color: #878B90;}
      .context .separator {margin:4px 0px; height:0; padding:0; border-top:1px solid #454545;}
      .hotkey {color:#878B90; float:right;}
    </style>
  </head>
  <body style='font: 12px Verdana, sans-serif'>
    <div class="c">
      <div class="row">
        <div class="graphCol">
          <div id='canvasDiv'><canvas id='canvas' style='width: 100%;'></canvas></div>
          <div id='box'><div id='hl'><span></span></div></div>
          <p id='match'>Matched: <span id='matchedLabel'></span></p>
          <p id='status'>&nbsp;</p>
        </div>
        <button class="sidebarToggle" onclick="toggleSidebarVisibility()">&lt;</button>
        <div class="configCol">
          <div class="configBlock">
            <div id="titleDiv">
              <b><center><span id="graphTitleSpan">Flamegraph</span></center></b>
              <hr>
            </div>
            <div class="row">
              <label for="highlightInput">Highlight:</label>
              <input placeholder="String or /regex/" name="highlightInput" id="highlightInput"/>
            </div>
            <div class="row">
              <button onclick="highlightApply()">Highlight</button>
              <button onclick="highlightClear()">Clear</button>
            </div>
            <br>
            <hr>
            <br>

            <label>Minimal frame width (in pixels):</label><br>
            <input id="minFrameWidthInPx" value="0.25"/><br>
            <div>
              <label><input type="checkbox" id="isReversedInput">Reversed</label>
              <span id="isNormalizedDiv" style="display:none;">
                <label><input type="checkbox" id="isNormalized" name="isNormalized">Normalized</label>
              </span>
            </div>
            <div>
              <label><input type="radio" id="sortByNameRadio" name="sortBy" value="name">Sort by name</label>
              <label><input type="radio" id="sortByWidthRadio" name="sortBy" value="width" checked>Sort by width</label>
            </div>
            <br>

            <div class="row">
              <div class="col">
                <label for="newTransformType">Add a transform:</label>

                <select name="newTransformType" id="newTransformType">
                  <option value="filter">Filter</option>
                  <option value="remove">Remove</option>
                  <option value="replace">Replace</option>
                </select>
              </div>
              <div class="col col-2">
                <button onclick="addNewTransform()">Add</button>
              </div>
            </div>
            <p><i>Right-click any stackframe to add common transforms.</i></p>
            <br>

            <div id="transformsContainer">
            </div>

            <div id="transformReplaceTemplate" style="display:none">
              <div class="row">
                <div class="col col-3">
                  <label>Replace:</label><br>
                </div>
                <div class="col">
                  <input type="checkbox" class="chkEnabled" onclick="refreshAfterEnabledToggle()" checked>
                  <button class="minibtn btnMoveUp" title="Move up" onclick="moveTransformUp(this)">↑</button>
                  <button class="minibtn btnMoveDown" title="Move down" onclick="moveTransformDown(this)">↓</button>
                  <button class="minibtn btnClone" title="Clone" onclick="cloneTransform(this)">☍</button>
                  <button class="minibtn btnDelete" title="Delete" onclick="deleteTransform(this)">✖</button>
                </div>
              </div>
              <div class="row" style="margin-top:1px;margin-bottom:1px">
                <div class="col w-100 no-vmargins">
                  <input class="what no-vmargins w-100" placeholder="String or /regex/"/><br>
                </div>
              </div>
              <div class="row" style="margin-top:1px;margin-bottom:1px">
                <div class="col w-100 no-vmargins">
                  <input class="replacement no-vmargins w-100" placeholder="Replacement"/><br>
                </div>
              </div>
            </div>

            <div id="transformFilterTemplate" style="display:none" class="margins">
              <div class="row">
                <div class="col col-3">
                  <label class="label">Filter:</label><br>
                </div>
                <div class="col">
                  <input type="checkbox" class="chkEnabled" onclick="refreshAfterEnabledToggle()" checked>
                  <button class="minibtn btnMoveUp" title="Move up" onclick="moveTransformUp(this)">↑</button>
                  <button class="minibtn btnMoveDown" title="Move down" onclick="moveTransformDown(this)">↓</button>
                  <button class="minibtn btnClone" title="Clone" onclick="cloneTransform(this)">☍</button>
                  <button class="minibtn btnDelete" title="Delete" onclick="deleteTransform(this)">✖</button>
                </div>
              </div>
              <div class="row">
                <div class="col w-100 margins">
                  <input class="what margins w-100" placeholder="String or /regex/"/><br>
                </div>
              </div>
            </div>

            <hr>
            <button onclick="applyConfiguration()">Apply</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      // This file was derived from flamegraph.html from the project
// https://github.com/jvm-profiling-tools/async-profiler
// Licensed under the Apache License, Version 2.0. Copyright 2020 Andrei Pangin

/// Constants
const canvas = document.getElementById('canvas');
const c = canvas.getContext('2d');
const hl = document.getElementById('hl');
const status = document.getElementById('status');
const matchContainer = document.getElementById('match');
const transformFilterTemplate = document.getElementById('transformFilterTemplate');
const transformReplaceTemplate = document.getElementById('transformReplaceTemplate');
const sidebarToggleButton = document.getElementsByClassName('sidebarToggle')[0];
const sidebarWidth = document.getElementsByClassName('configCol')[0].offsetWidth
const qString = new URLSearchParams(window.location.search)

var sidebarVisible = true;
var canvasWidth;

if (qString.get('hide-sidebar') == 'true') {
  sidebarVisible = false;
}

function updateSidebarState() {
  let style = oneByClass(document, 'configCol').style
  if (sidebarVisible) {
    style.display = 'block';
    sidebarToggleButton.innerText = ">";
    canvasWidth = window.innerWidth - sidebarWidth - 36;
  } else {
    style.display = 'none';
    sidebarToggleButton.innerText = "<";
    canvasWidth = window.innerWidth - 36;
  }
}

updateSidebarState();

var graphTitle = "";
var isDiffgraph = false;
var normalizeDiff = false, b_scale_factor;
var reverseGraph = false;
var idToFrame = ["[not_walkable_Java]",
"_new_instance_Java",
"CardTableBarrierSet::on_slowpath_allocation_exit(JavaThread*, oopDesc*)",
"[unknown_Java]",
"Interpreter",
"G1BarrierSetRuntime::write_ref_field_post_entry(unsigned char volatile*, JavaThread*)",
"G1DirtyCardQueueSet::enqueue(G1DirtyCardQueue&, unsigned char volatile*)",
"PtrQueueSet::exchange_buffer_with_new(PtrQueue&)",
"FreeListAllocator::allocate()",
"OptoRuntime::new_instance_C(Klass*, JavaThread*)",
"pthread_jit_write_protect_np",
"os::current_thread_enable_wx(WXMode)",
"clojure.main.main",
"clojure.lang.Var.applyTo",
"clojure.lang.RestFn.applyTo",
"clojure.lang.AFn.applyToHelper",
"clojure.lang.RestFn.invoke",
"clojure.main/main",
"clojure.main/repl-opt",
"clojure.main/repl",
"clojure.main/repl/fn--9215",
"clojure.main/repl/read-eval-print--9206",
"clojure.main/repl/read-eval-print--9206/fn--9209",
"clojure.core/eval",
"clojure.lang.Compiler.eval",
"user$eval568.invoke",
"user$eval568.invokeStatic",
"clj-async-profiler.core/start",
"clj-async-profiler.core/attach-agent",
"sun.tools.attach.HotSpotVirtualMachine.loadAgentPath",
"sun.tools.attach.HotSpotVirtualMachine.loadAgentLibrary",
"sun.tools.attach.VirtualMachineImpl.execute",
"sun.tools.attach.HotSpotVirtualMachine.readInt",
"sun.tools.attach.VirtualMachineImpl$SocketInputStream.read",
"sun.tools.attach.VirtualMachineImpl.read",
"read",
"user$eval568$fn__569.invoke",
"clj-async-profiler.core/stop",
"clj-async-profiler.core/status",
"clojure.core/slurp",
"clojure.core/apply",
"clojure.lang.RT.boundedLength",
"clojure.lang.PersistentList.next",
"tutorial.binary-trees/main",
"clojure.core/seq--5467",
"clojure.lang.RT.seq",
"clojure.lang.LazySeq.seq",
"clojure.lang.LazySeq.sval",
"clojure.core/map/fn--5935",
"tutorial.binary-trees/main/fn--449",
"tutorial.binary-trees/iterate-trees",
"clojure.core/reduce",
"clojure.core.protocols/fn--8178/G--8173--8191",
"clojure.core.protocols/fn--8236",
"clojure.core.protocols/seq-reduce",
"clojure.core.protocols/fn--8204/G--8199--8213",
"clojure.core.protocols/fn--8244",
"clojure.core/chunk-next",
"clojure.lang.ChunkedCons.chunkedNext",
"clojure.core/chunk",
"clojure.core/chunk-buffer",
"clojure.core/chunk-cons",
"clojure.lang.RT.count",
"clojure.lang.RT.countFrom",
"clojure.core/chunk-first",
"clojure.lang.LongRange.chunkedFirst",
"clojure.lang.LongRange.forceChunk",
"clojure.lang.ChunkBuffer.chunk",
"itable stub",
"tutorial.binary-trees/iterate-trees/fn--442",
"clojure.lang.Numbers.add",
"clojure.lang.Numbers$LongOps.add",
"clojure.lang.Numbers.minus",
"clojure.lang.Numbers$LongOps.negate",
"clojure.lang.Numbers.num",
"java.lang.Long.valueOf",
"tutorial.binary-trees/bottom-up-tree",
"tutorial.binary-trees/item-check",
"clojure.lang.Numbers.dec",
"clojure.lang.Numbers$LongOps.dec",
"clojure.lang.Numbers.multiply",
"clojure.lang.Numbers.ops",
"clojure.lang.RT.intCast",
"clojure.lang.RT.longCast",
"InstanceKlass::allocate_instance(JavaThread*)",
"MemAllocator::allocate() const",
"MemAllocator::allocate_inside_tlab_slow(MemAllocator::Allocation&) const",
"_platform_memset",
"clojure.lang.Numbers$LongOps.multiply",
"G1CollectedHeap::attempt_allocation(unsigned long, unsigned long, unsigned long*)",
"G1CollectedHeap::attempt_allocation_slow(unsigned long)",
"G1AllocRegion::new_alloc_region_and_allocate(unsigned long, bool)",
"G1CollectedHeap::new_mutator_alloc_region(unsigned long, bool, unsigned int)",
"HeapRegionManager::allocate_free_region(HeapRegionType, unsigned int)",
"MasterFreeRegionListChecker::check_mt_safety()",
"ThreadLocalAllocBuffer::fill(HeapWordImpl**, HeapWordImpl**, unsigned long)",
"java.lang.Character.charValue",
"ThreadLocalAllocBuffer::print_stats(char const*)",
"MemAllocator::Allocation::notify_allocation()",
"AllocTracer::send_allocation_in_new_tlab(Klass*, HeapWordImpl**, unsigned long, unsigned long, JavaThread*)",
"JfrAllocationTracer::JfrAllocationTracer(Klass const*, HeapWordImpl**, unsigned long, bool, JavaThread*)",
"ObjectSampler::is_created()",
"tlv_get_addr",
"java.lang.Integer.intValue",
"MutatorAllocRegion::retire(bool)",
"G1AllocRegion::retire_internal(HeapRegion*, bool)",
"G1CollectedHeap::retire_mutator_alloc_region(HeapRegion*, unsigned long)",
"G1CollectionSet::add_young_region_common(HeapRegion*)",
"G1Policy::predict_region_non_copy_time_ms(HeapRegion*, bool) const",
"clojure.lang.Numbers$LongOps.combine",
"SafepointSynchronize::handle_polling_page_exception(JavaThread*)",
"ThreadSafepointState::handle_polling_page_exception()",
"SafepointMechanism::process(JavaThread*, bool, bool)",
"SafepointSynchronize::block(JavaThread*)",
"GenericWaitBarrier::wait(int)",
"semaphore_wait_trap",
"clojure.lang.Util.identical",
"clojure.lang.Var.getRawRoot",
"OopMapCache::cleanup_old_entries()",
"G1Policy::preventive_collection_required(unsigned int)",
"G1MonitoringSupport::update_eden_size()",
"G1MonitoringSupport::recalculate_sizes()",
"G1CommittedRegionMap::num_active() const",
"ObjAllocator::initialize(HeapWordImpl**) const",
"clojure.lang.ArrayChunk.reduce",
"clojure.core/+",
"Mutex::owned_by_self() const",
"clojure.lang.Numbers$LongOps.opsWith",
"tutorial.binary_trees.TreeNode.<init>",
"Runtime1::new_instance(JavaThread*, Klass*)",
"G1RemSetTrackingPolicy::update_at_allocate(HeapRegion*)",
"G1FromCardCache::clear(unsigned int)",
"InlineCacheBuffer",
"java.lang.Integer.valueOf",
"java.lang.Thread.run",
"sun.net.httpserver.ServerImpl$Dispatcher.run",
"java.lang.ClassLoader.loadClass",
"jdk.internal.loader.BuiltinClassLoader.loadClass",
"jdk.internal.loader.BuiltinClassLoader.loadClassOrNull",
"jdk.internal.loader.BuiltinClassLoader.findClassInModuleOrNull",
"jdk.internal.loader.BuiltinClassLoader.defineClass",
"java.security.SecureClassLoader.defineClass",
"java.lang.ClassLoader.defineClass",
"java.lang.ClassLoader.defineClass2",
"Java_java_lang_ClassLoader_defineClass2",
"JVM_DefineClassWithSource",
"jvm_define_class_common(char const*, _jobject*, signed char const*, int, _jobject*, char const*, JavaThread*)",
"SystemDictionary::resolve_class_from_stream(ClassFileStream*, Symbol*, Handle, ClassLoadInfo const&, JavaThread*)",
"KlassFactory::create_from_stream(ClassFileStream*, Symbol*, ClassLoaderData*, ClassLoadInfo const&, JavaThread*)",
"ClassFileParser::ClassFileParser(ClassFileStream*, Symbol*, ClassLoaderData*, ClassLoadInfo const*, ClassFileParser::Publicity, JavaThread*)",
"ClassFileParser::parse_stream(ClassFileStream const*, JavaThread*)",
"ClassFileParser::parse_methods(ClassFileStream const*, bool, AccessFlags*, bool*, bool*, JavaThread*)",
"ClassFileParser::parse_method(ClassFileStream const*, bool, ConstantPool const*, AccessFlags*, JavaThread*)",
"ClassFileParser::parse_localvariable_table(ClassFileStream const*, unsigned int, unsigned short, unsigned int, unsigned short*, bool, JavaThread*)",
"sun.net.httpserver.ServerImpl$Dispatcher.handle",
"PerfByteArray::~PerfByteArray()",
"sun.net.httpserver.ServerImpl$DefaultExecutor.execute",
"sun.net.httpserver.ServerImpl$Exchange.run",
"InterpreterRuntime::_new(JavaThread*, ConstantPool*, int)",
"InstanceKlass::initialize_impl(JavaThread*)",
"InstanceKlass::link_class_impl(JavaThread*)",
"Verifier::verify(InstanceKlass*, bool, JavaThread*)",
"ClassVerifier::verify_class(JavaThread*)",
"ClassVerifier::verify_method(methodHandle const&, JavaThread*)",
"ClassVerifier::verify_field_instructions(RawBytecodeStream*, StackMapFrame*, constantPoolHandle const&, bool, JavaThread*)",
"SignatureStream::find_symbol()",
"SymbolTable::new_symbol(char const*, int)",
"com.sun.net.httpserver.Filter$Chain.doFilter",
"sun.net.httpserver.ServerImpl$Exchange$LinkHandler.handle",
"sun.net.httpserver.AuthFilter.doFilter",
"clj_async_profiler.wwws.proxy$java.lang.Object$HttpHandler$b3c1ac8.handle",
"clj-async-profiler.wwws/start-server/fn--502",
"clj-async-profiler.wwws/root-handler",
"InterpreterRuntime::resolve_from_cache(JavaThread*, Bytecodes::Code)",
"clj-async-profiler.ui/start-server/fn--563",
"clj-async-profiler.ui/handler",
"clj-async-profiler.ui/main-page",
"clj-async-profiler.ui/profiler-controls",
"clojure.string/join",
"clj-async-profiler.ui/main-page/iter--529--533/fn--534",
"java.io.File.length",
"java.io.UnixFileSystem.getLength",
"java.io.UnixFileSystem.getLength0",
"InterpreterRuntime::prepare_native_call(JavaThread*, Method*)",
"NativeLookup::lookup(methodHandle const&, JavaThread*)",
"NativeLookup::lookup_base(methodHandle const&, JavaThread*)",
"NativeLookup::lookup_entry(methodHandle const&, JavaThread*)",
"NativeLookup::lookup_style(methodHandle const&, char*, char const*, int, bool, JavaThread*)",
"[unknown]",
"clj-async-profiler.wwws/query-string->map",
"clojure.core/keep",
"jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass",
"jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull",
"jdk.internal.loader.URLClassPath$JarLoader$2.getBytes",
"jdk.internal.loader.Resource.getBytes",
"java.util.zip.InflaterInputStream.read",
"java.util.zip.Inflater.inflate",
"java.util.zip.Inflater.inflateBytesBytes",
"Java_java_util_zip_Inflater_inflateBytesBytes",
"inflate_fast",
"clj-async-profiler.wwws/serve-file",
"clojure.java.io/input-stream",
"clojure.java.io/fn--11569/G--11523--11576",
"clojure.core/-cache-protocol-fn",
"clojure.core/expand-method-impl-cache",
"clojure.core/into1",
"clojure.core/reduce1",
"clojure.core/filter/fn--5962",
"clojure.core/vec",
"clojure.lang.LazilyPersistentVector.create",
"SharedRuntime::resolve_opt_virtual_call_C(JavaThread*)",
"SharedRuntime::resolve_helper(bool, bool, JavaThread*)",
"SharedRuntime::resolve_sub_helper(bool, bool, JavaThread*)",
"vframeStream::vframeStream(JavaThread*, bool, bool, bool)",
"frame::sender_for_compiled_frame(RegisterMap*) const",
"ImmutableOopMap::update_register_map(frame const*, RegisterMap*) const",
"sun.net.httpserver.HttpExchangeImpl.sendResponseHeaders",
"sun.net.httpserver.ExchangeImpl.sendResponseHeaders",
"jdk.internal.module.SystemModuleFinders$SystemModuleReader.read",
"jdk.internal.module.SystemModuleFinders$SystemModuleReader.findImageLocation",
"jdk.internal.jimage.ImageReader.findLocation",
"jdk.internal.jimage.BasicImageReader.findLocation",
"jdk.internal.jimage.BasicImageReader.getAttributes",
"jdk.internal.jimage.ImageLocation.decompress",
"java.lang.invoke.MethodHandleNatives.linkCallSite",
"java.lang.invoke.MethodHandleNatives.linkCallSiteImpl",
"java.lang.invoke.CallSite.makeSite",
"java.lang.invoke.BootstrapMethodInvoker",
"java.lang.invoke.Invokers$Holder.invokeExact_MT",
"java.lang.invoke.DelegatingMethodHandle$Holder.delegate",
"java.lang.invoke.DirectMethodHandle/Holder",
"java.lang.invoke.StringConcatFactory.makeConcatWithConstants",
"java.lang.invoke.StringConcatFactory.generateMHInlineCopy",
"java.lang.invoke.StringConcatFactory.filterInPrependers",
"java.lang.invoke.MethodHandles.filterArgumentsWithCombiner",
"java.lang.invoke.MethodHandles.argumentsWithCombiner",
"java.lang.invoke.BoundMethodHandle$Species_L.copyWithExtendL",
"java.lang.invoke.BoundMethodHandle$Species_LL.make",
"java.lang.invoke.BoundMethodHandle$Species_LL.<init>",
"java.lang.invoke.BoundMethodHandle.<init>",
"java.lang.invoke.MethodHandle.<init>",
"java.lang.invoke.LambdaForm.prepare",
"java.lang.invoke.LambdaForm.compileToBytecode",
"java.lang.invoke.InvokerBytecodeGenerator.generateCustomizedCode",
"java.lang.invoke.InvokerBytecodeGenerator.loadMethod",
"java.lang.invoke.InvokerBytecodeGenerator.classDataValues",
"java.time.format.DateTimeFormatter.format",
"java.time.format.DateTimeFormatter.formatTo",
"java.time.format.DateTimeFormatterBuilder$CompositePrinterParser.format",
"java.time.format.DateTimeFormatterBuilder$NumberPrinterParser.format",
"InterpreterRuntime::resolve_get_put(JavaThread*, Bytecodes::Code)",
"LinkResolver::resolve_field_access(fieldDescriptor&, constantPoolHandle const&, int, methodHandle const&, Bytecodes::Code, JavaThread*)",
"LinkResolver::resolve_field(fieldDescriptor&, LinkInfo const&, Bytecodes::Code, bool, JavaThread*)",
"JvmtiExport::post_class_prepare(JavaThread*, Klass*)",
"VM::loadMethodIDs(_jvmtiEnv*, JNIEnv_*, _jclass*)",
"jvmti_GetClassMethods(_jvmtiEnv*, _jclass*, int*, _jmethodID***)",
"JvmtiEnv::GetClassMethods(oopDesc*, int*, _jmethodID***)",
"os::malloc(unsigned long, MEMFLAGS)",
"malloc",
"java.time.format.DateTimeFormatterBuilder$TextPrinterParser.format",
"java.time.format.DateTimeTextProvider.getText",
"java.time.format.DateTimeTextProvider.findStore",
"java.time.format.DateTimeTextProvider.createStore",
"sun.util.locale.provider.CalendarDataUtility.retrieveJavaTimeFieldValueName",
"sun.util.locale.provider.LocaleServiceProviderPool.getLocalizedObject",
"sun.util.locale.provider.LocaleServiceProviderPool.getLocalizedObjectImpl",
"sun.util.locale.provider.CalendarDataUtility$CalendarFieldValueNameGetter.getObject",
"sun.util.locale.provider.CalendarNameProviderImpl.getJavaTimeDisplayName",
"sun.util.locale.provider.CalendarNameProviderImpl.getDisplayNameImpl",
"java.lang.String.replaceFirst",
"java.util.regex.Pattern.compile",
"java.util.regex.Pattern.<init>",
"java.util.regex.Pattern$BnM.optimize",
"InterpreterRuntime::newarray(JavaThread*, BasicType, int)",
"sun.util.locale.provider.CalendarDataUtility.retrieveJavaTimeFieldValueNames",
"sun.util.locale.provider.CalendarDataUtility$CalendarFieldValueNamesMapGetter.getObject",
"sun.util.locale.provider.CalendarNameProviderImpl.getJavaTimeDisplayNames",
"sun.util.locale.provider.CalendarNameProviderImpl.getDisplayNamesImpl",
"java.util.regex.Matcher.replaceFirst",
"InterpreterRuntime::resolve_invoke(JavaThread*, Bytecodes::Code)",
"LinkResolver::resolve_invokevirtual(CallInfo&, Handle, constantPoolHandle const&, int, JavaThread*)",
"LinkResolver::linktime_resolve_virtual_method(LinkInfo const&, JavaThread*)",
"LinkResolver::resolve_method(LinkInfo const&, Bytecodes::Code, JavaThread*)",
"LinkResolver::check_method_accessability(Klass*, Klass*, Klass*, methodHandle const&, JavaThread*)",
"Reflection::verify_member_access(Klass const*, Klass const*, Klass const*, AccessFlags, bool, bool, JavaThread*)",
"sun.util.locale.provider.LocaleResources.getJavaTimeNames",
"sun.util.locale.provider.LocaleResources.getJavaTimeFormatData",
"sun.util.resources.LocaleData.getDateFormatData",
"sun.util.resources.LocaleData.getBundle",
"java.security.AccessController.doPrivileged",
"java.security.AccessController.executePrivileged",
"sun.util.resources.LocaleData$1.run",
"sun.util.resources.Bundles.of",
"sun.util.resources.Bundles.loadBundleOf",
"sun.util.resources.Bundles.findBundleOf",
"java.util.ResourceBundle$1.newResourceBundle",
"java.util.ResourceBundle$ResourceBundleProviderHelper.newResourceBundle",
"java.lang.reflect.Constructor.newInstance",
"java.lang.reflect.Constructor.newInstanceWithCaller",
"java.lang.reflect.Constructor.acquireConstructorAccessor",
"jdk.internal.reflect.ReflectionFactory.newConstructorAccessor",
"jdk.internal.reflect.MethodHandleAccessorFactory.newConstructorAccessor",
"java.lang.invoke.MethodHandleImpl$1.unreflectConstructor",
"java.lang.invoke.MethodHandles$Lookup.unreflectConstructor",
"java.lang.invoke.MemberName.<init>",
"sun.util.locale.provider.LocaleServiceProviderPool.findProviders",
"sun.util.locale.provider.JRELocaleProviderAdapter.getLocaleServiceProvider",
"sun.util.cldr.CLDRLocaleProviderAdapter.getCalendarNameProvider",
"sun.util.cldr.CLDRLocaleProviderAdapter$$Lambda$60.0x00000008004531e0.run",
"sun.util.cldr.CLDRLocaleProviderAdapter.lambda$getCalendarNameProvider$2",
"ConstantPool::klass_at_impl(constantPoolHandle const&, int, JavaThread*)",
"SystemDictionary::resolve_or_fail(Symbol*, Handle, Handle, bool, JavaThread*)",
"SystemDictionary::resolve_instance_class_or_null(Symbol*, Handle, Handle, JavaThread*)",
"SystemDictionary::load_instance_class(unsigned int, Symbol*, Handle, JavaThread*)",
"SystemDictionary::load_instance_class_impl(Symbol*, Handle, JavaThread*)",
"ClassLoader::load_class(Symbol*, bool, JavaThread*)",
"ClassPathImageEntry::open_stream_for_loader(JavaThread*, char const*, ClassLoaderData*)",
"JIMAGE_GetResource",
"pread",
"java.time.format.DateTimeFormatterBuilder$ZoneTextPrinterParser.format",
"java.time.format.DateTimeFormatterBuilder$ZoneTextPrinterParser.getDisplayName",
"sun.util.locale.provider.TimeZoneNameUtility.retrieveDisplayNames",
"sun.util.locale.provider.TimeZoneNameUtility.retrieveDisplayNamesImpl",
"sun.util.cldr.CLDRLocaleProviderAdapter.getTimeZoneNameProvider",
"sun.util.cldr.CLDRLocaleProviderAdapter$$Lambda$62.0x00000008004566b0.run",
"sun.util.cldr.CLDRLocaleProviderAdapter.lambda$getTimeZoneNameProvider$3",
"sun.util.locale.provider.JRELocaleProviderAdapter.getLanguageTagSet",
"sun.util.cldr.CLDRLocaleProviderAdapter.createLanguageTagSet",
"java.lang.String.split",
"java.util.regex.Pattern.split",
"LinkResolver::resolve_invokeinterface(CallInfo&, Handle, constantPoolHandle const&, int, JavaThread*)",
"InstanceKlass::uncached_lookup_method(Symbol const*, Symbol const*, Klass::OverpassLookupMode, Klass::PrivateLookupMode) const",
"sun.util.locale.provider.TimeZoneNameUtility$TimeZoneNameGetter.getObject",
"sun.util.locale.provider.TimeZoneNameUtility$TimeZoneNameGetter.getName",
"sun.util.locale.provider.TimeZoneNameProviderImpl.getDisplayName",
"sun.util.cldr.CLDRTimeZoneNameProviderImpl.getDisplayNameArray",
"sun.util.cldr.CLDRTimeZoneNameProviderImpl.deriveFallbackName",
"sun.util.locale.provider.LocaleResources.getTimeZoneNames",
"sun.util.resources.LocaleData.getTimeZoneNames",
"java.lang.Class.forName",
"jdk.internal.loader.BootLoader.loadClass",
"jdk.internal.loader.BootLoader.loadClassOrNull",
"java.lang.System$2.findBootstrapClassOrNull",
"java.lang.ClassLoader.findBootstrapClassOrNull",
"java.lang.ClassLoader.findBootstrapClass",
"Java_java_lang_ClassLoader_findBootstrapClass",
"JVM_FindClassFromBootLoader",
"ClassFileParser::parse_constant_pool(ClassFileStream const*, ConstantPool*, int, JavaThread*)",
"ClassFileParser::parse_constant_pool_entries(ClassFileStream const*, ConstantPool*, int, JavaThread*)",
"SymbolTable::lookup_only(char const*, int, unsigned int&)",
"sun.util.locale.provider.TimeZoneNameProviderImpl.getDisplayNameArray",
"java.util.ResourceBundle.containsKey",
"sun.util.resources.OpenListResourceBundle.handleKeySet",
"sun.util.resources.OpenListResourceBundle.loadLookupTablesIfNecessary",
"sun.util.resources.OpenListResourceBundle.loadLookup",
"sun.util.resources.cldr.TimeZoneNames.getContents",
"InterpreterRuntime::resolve_ldc(JavaThread*, Bytecodes::Code)",
"Bytecode_loadconstant::resolve_constant(JavaThread*) const",
"ConstantPool::resolve_constant_at_impl(constantPoolHandle const&, int, int, bool*, JavaThread*)",
"StringTable::intern(Symbol*, JavaThread*)",
"StringTable::do_intern(Handle, unsigned short const*, int, unsigned long, JavaThread*)",
"java_lang_String::create_from_unicode(unsigned short const*, int, JavaThread*)",
"java.util.stream.ReferencePipeline.anyMatch",
"java.util.stream.MatchOps.makeRef",
"sun.net.httpserver.PlaceholderOutputStream.close",
"sun.net.httpserver.ChunkedOutputStream.close",
"sun.net.httpserver.ChunkedOutputStream.writeChunk",
"sun.net.httpserver.Request$WriteStream.write",
"java.nio.Buffer.capacity",
"InterpreterRuntime::frequency_counter_overflow(JavaThread*, unsigned char*)",
"InterpreterRuntime::frequency_counter_overflow_inner(JavaThread*, unsigned char*)",
"CompilationPolicy::event(methodHandle const&, methodHandle const&, int, int, CompLevel, CompiledMethod*, JavaThread*)",
"CompileBroker::compile_method(methodHandle const&, int, int, methodHandle const&, int, CompileTask::CompileReason, JavaThread*)",
"CompileBroker::compile_method(methodHandle const&, int, int, methodHandle const&, int, CompileTask::CompileReason, DirectiveSet*, JavaThread*)",
"CompileBroker::compile_method_base(methodHandle const&, int, int, methodHandle const&, int, CompileTask::CompileReason, bool, Thread*)",
"CompileBroker::create_compile_task(CompileQueue*, int, methodHandle const&, int, int, methodHandle const&, int, CompileTask::CompileReason, bool)",
"__psynch_cvbroad",
"sun.net.httpserver.ExchangeImpl.<clinit>",
"java.time.format.DateTimeFormatter.<clinit>",
"java.time.format.DateTimeFormatterBuilder.<clinit>",
"java.lang.invoke.LambdaMetafactory.metafactory",
"java.lang.invoke.InnerClassLambdaMetafactory.buildCallSite",
"java.lang.invoke.InnerClassLambdaMetafactory.spinInnerClass",
"java.lang.invoke.InnerClassLambdaMetafactory.generateInnerClass",
"java.lang.invoke.InnerClassLambdaMetafactory.generateConstructor",
"jdk.internal.org.objectweb.asm.MethodWriter.visitInsn",
"SharedRuntime::find_callee_info_helper(vframeStream&, Bytecodes::Code&, CallInfo&, JavaThread*)",
"java.time.format.DateTimeFormatterBuilder.appendText",
"java.time.format.DateTimeFormatterBuilder.toFormatter",
"SymbolTable::do_lookup(char const*, int, unsigned long)",
"sun.net.httpserver.ExchangeImpl.<init>",
"com.sun.net.httpserver.Headers.of",
"com.sun.net.httpserver.Headers.<init>",
"LinkInfo::LinkInfo(constantPoolHandle const&, int, JavaThread*)",
"ConstantPool::klass_ref_at(int, JavaThread*)",
"java_lang_String::externalize_classname(Symbol*, JavaThread*)",
"_platform_memmove",
"com.sun.net.httpserver.Headers.putAll",
"java.util.Map.forEach",
"com.sun.net.httpserver.Headers$$Lambda$58.0x0000000800416450.accept",
"com.sun.net.httpserver.Headers.put",
"java.util.AbstractSequentialList.iterator",
"java.util.AbstractList.listIterator",
"sun.net.httpserver.Request.<init>",
"sun.net.httpserver.Request.readLine",
"java.io.BufferedInputStream.read",
"java.io.BufferedInputStream.implRead",
"java.io.BufferedInputStream.fill",
"sun.net.httpserver.Request$ReadStream.read",
"jdk.internal.loader.ClassLoaders$BootClassLoader.loadClassOrNull",
"Dictionary::find(unsigned int, Symbol*, Handle)",
"sun.nio.ch.SocketChannelImpl.read",
"sun.nio.ch.IOUtil.read",
"sun.nio.ch.IOUtil.readIntoNativeBuffer",
"sun.nio.ch.SocketDispatcher.read",
"sun.nio.ch.SocketDispatcher.read0",
"java.lang.ClassLoader.findNative",
"jdk.internal.loader.NativeLibraries.find",
"jdk.internal.loader.NativeLibraries$NativeLibraryImpl.find",
"jdk.internal.loader.NativeLibrary.findEntry0",
"Java_jdk_internal_loader_NativeLibrary_findEntry0",
"JVM_FindLibraryEntry",
"sun.nio.ch.SelectorImpl.select",
"sun.nio.ch.SelectorImpl.lockAndDoSelect",
"sun.nio.ch.KQueueSelectorImpl.doSelect",
"sun.nio.ch.SelectorImpl.processDeregisterQueue",
"sun.nio.ch.SelectorImpl.selectNow",
"sun.nio.ch.KQueue.poll",
"kevent",
"sun.nio.ch.ServerSocketChannelImpl.accept",
"sun.nio.ch.ServerSocketChannelImpl.finishAccept",
"thread_start",
"_pthread_start",
"thread_native_entry(Thread*)",
"Thread::call_run()",
"ConcurrentGCThread::run()",
"G1ServiceThread::run_service()",
"G1ServiceThread::wait_for_task()",
"Monitor::wait_without_safepoint_check(long long)",
"os::PlatformMonitor::wait(long)",
"__psynch_cvwait",
"pthread_testcancel",
"os::elapsed_counter()",
"os::javaTimeNanos()",
"JavaThread::thread_main_inner()",
"CompileBroker::compiler_thread_loop()",
"CompileBroker::invoke_compiler_on_method(CompileTask*)",
"C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)",
"Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)",
"Compile::Code_Gen()",
"Matcher::match()",
"Matcher::find_shared(Node*)",
"Matcher::pd_clone_node(Node*, Node*, Matcher::MStack&)",
"Matcher::is_vshift_con_pattern(Node*, Node*)",
"Matcher::xform(Node*, int)",
"Matcher::match_tree(Node const*)",
"Matcher::Label_Root(Node const*, State*, Node*, Node*&)",
"TypeNarrowPtr::singleton() const",
"PhaseBlockLayout::PhaseBlockLayout(PhaseCFG&)",
"PhaseBlockLayout::merge_traces(bool)",
"PhaseCFG::do_global_code_motion()",
"PhaseCFG::global_code_motion()",
"Node_Backward_Iterator::next()",
"PhaseCFG::schedule_late(VectorSet&, Node_Stack&)",
"PhaseCFG::hoist_to_cheaper_block(Block*, Block*, Node*)",
"loadI_volatileNode::out_RegMask() const",
"PhaseCFG::schedule_local(Block*, GrowableArray<int>&, VectorSet&, long*)",
"PhaseCFG::sched_call(Block*, unsigned int, Node_List&, GrowableArray<int>&, MachCallNode*, VectorSet&)",
"PhaseCFG::schedule_pinned_nodes(VectorSet&)",
"PhaseRegAlloc::PhaseRegAlloc(unsigned int, PhaseCFG&, Matcher&, void (*)())",
"PhaseCFG::remove_empty_blocks()",
"PhaseCFG::move_to_end(Block*, unsigned int)",
"PhaseChaitin::Register_Allocate()",
"CProjNode::is_block_proj() const",
"PhaseAggressiveCoalesce::insert_copies(Matcher&)",
"PhaseChaitin::Select()",
"IndexSetIterator::advance_and_next()",
"PhaseIFG::re_insert(unsigned int)",
"PhaseChaitin::Split(unsigned int, ResourceArea*)",
"MachNode::rematerialize() const",
"MachNode::ideal_reg() const",
"PhaseChaitin::split_Rematerialize(Node*, Block*, unsigned int, unsigned int&, GrowableArray<unsigned int>, int, unsigned int*, Node**, bool)",
"iRegPNoSpOper::clone() const",
"PhaseChaitin::build_ifg_physical(ResourceArea*)",
"PhaseChaitin::interfere_with_live(unsigned int, IndexSet*)",
"RegMask::Size() const",
"PhaseChaitin::gather_lrg_masks(bool)",
"PhaseChaitin::post_allocate_copy_removal()",
"PhaseChaitin::elide_copy(Node*, int, Block*, Node_List&, Node_List&, bool)",
"PhaseCoalesce::coalesce_driver()",
"PhaseConservativeCoalesce::coalesce(Block*)",
"PhaseIFG::SquareUp()",
"PhaseIFG::init(unsigned int)",
"IndexSet::initialize(unsigned int)",
"PhaseLive::compute(unsigned int)",
"iRegINoSpOper::type() const",
"PhaseOutput::Output()",
"PhaseOutput::BuildOopMaps()",
"PhaseOutput::fill_buffer(CodeBuffer*, unsigned int*)",
"NonSafepointEmitter::observe_instruction(Node*, int)",
"JVMState::same_calls_as(JVMState const*) const",
"PhaseOutput::Process_OopMap_Node(MachNode*, int)",
"PhaseOutput::FillLocArray(int, MachSafePointNode*, Node*, GrowableArray<ScopeValue*>*, GrowableArray<ScopeValue*>*)",
"PhaseRegAlloc::is_oop(Node const*) const",
"loadConNKlassNode::emit(CodeBuffer&, PhaseRegAlloc*) const",
"MacroAssembler::set_narrow_klass(RegisterImpl const*, Klass*)",
"OopRecorder::find_index(Metadata*)",
"ValueRecorder<Metadata*>::maybe_find_index(Metadata*)",
"PhaseOutput::shorten_branches(unsigned int*)",
"PhaseOutput::scratch_emit_size(Node const*)",
"MachOper::num_edges() const",
"PhaseOutput::install_code(ciMethod*, int, AbstractCompiler*, bool, bool, RTMState)",
"ciEnv::register_method(ciMethod*, int, CodeOffsets*, int, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, bool, bool, bool, int, RTMState)",
"Dependencies::validate_dependencies(CompileTask*, char**)",
"Dependencies::DepStream::check_new_klass_dependency(NewKlassDepChange*)",
"Dependencies::DepStream::argument(int)",
"ValueRecorder<Metadata*>::at(int)",
"nmethod::new_nmethod(methodHandle const&, int, int, CodeOffsets*, int, DebugInformationRecorder*, Dependencies*, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, int, char*, int, int, char const*, FailedSpeculation**)",
"nmethod::nmethod(Method*, CompilerType, int, int, int, CodeOffsets*, int, DebugInformationRecorder*, Dependencies*, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, int, char*, int, int)",
"CodeBuffer::copy_code_to(CodeBlob*)",
"CodeBuffer::relocate_code_to(CodeBuffer*) const",
"NativeCall::set_destination_mt_safe(unsigned char*, bool)",
"trampoline_stub_Relocation::get_trampoline_for(unsigned char*, nmethod*)",
"RelocIterator::set_limits(unsigned char*, unsigned char*)",
"Compile::Optimize()",
"CallGenerator::do_late_inline_helper()",
"ParseGenerator::generate(JVMState*)",
"Parse::Parse(JVMState*, ciMethod*, float)",
"Parse::do_all_blocks()",
"Parse::do_one_block()",
"Parse::do_call()",
"Parse::create_entry_map()",
"ciMethod::get_method_at_bci(int, bool&, ciSignature**)",
"ciBytecodeStream::get_method(bool&, ciSignature**)",
"ciEnv::get_method_by_index_impl(constantPoolHandle const&, int, Bytecodes::Code, ciInstanceKlass*)",
"ciObjectFactory::get_metadata(Metadata*)",
"Compile::final_graph_reshaping()",
"Compile::final_graph_reshaping_walk(Node_Stack&, Node*, Final_Reshape_Counts&)",
"Compile::final_graph_reshaping_impl(Node*, Final_Reshape_Counts&)",
"LoadNNode::Opcode() const",
"Compile::inline_incrementally_cleanup(PhaseIterGVN&)",
"PhaseIterGVN::optimize()",
"CallStaticJavaNode::Ideal(PhaseGVN*, bool)",
"PhaseIterGVN::transform_old(Node*)",
"RegionNode::Ideal(PhaseGVN*, bool)",
"RegionNode::is_unreachable_region(PhaseGVN const*)",
"RegionNode::is_unreachable_from_root(PhaseGVN const*) const",
"RegionNode::is_CFG() const",
"PhaseRemoveUseless::PhaseRemoveUseless(PhaseGVN*, Unique_Node_List*, Phase::PhaseNumber)",
"Compile::remove_useless_nodes(Unique_Node_List&)",
"Compile::optimize_loops(PhaseIterGVN&, LoopOptsMode)",
"PhaseIdealLoop::optimize(PhaseIterGVN&, LoopOptsMode)",
"PhaseIdealLoop::build_and_optimize()",
"Node::is_CFG() const",
"PhaseIdealLoop::Dominators()",
"PhaseIdealLoop::build_loop_late(VectorSet&, Node_List&, Node_Stack&)",
"PhaseIdealLoop::split_if_with_blocks(VectorSet&, Node_Stack&)",
"PhaseIdealLoop::split_if_with_blocks_pre(Node*)",
"AndINode::Opcode() const",
"Compile::print_method(CompilerPhaseType, int, Node*)",
"CompositeElapsedCounterSource::now()",
"mach_absolute_time",
"Compile::process_for_post_loop_opts_igvn(PhaseIterGVN&)",
"PhaseIterGVN::subsume_node(Node*, Node*)",
"PhaseIterGVN::remove_globally_dead_node(Node*)",
"Node::replace_edge(Node*, Node*, PhaseGVN*)",
"Node::set_req_X(unsigned int, Node*, PhaseIterGVN*)",
"ConnectionGraph::do_analysis(Compile*, PhaseIterGVN*)",
"ConnectionGraph::compute_escape()",
"ConnectionGraph::add_call_node(CallNode*)",
"ciMethod::get_bcea()",
"BCEscapeAnalyzer::BCEscapeAnalyzer(ciMethod*, BCEscapeAnalyzer*)",
"BCEscapeAnalyzer::compute_escape_info()",
"BCEscapeAnalyzer::iterate_blocks(Arena*)",
"BCEscapeAnalyzer::iterate_one_block(ciBlock*, BCEscapeAnalyzer::StateInfo&, GrowableArray<ciBlock*>&)",
"BCEscapeAnalyzer::invoke(BCEscapeAnalyzer::StateInfo&, Bytecodes::Code, ciMethod*, ciKlass*)",
"ciEnv::lookup_method(ciInstanceKlass*, ciKlass*, Symbol*, Symbol*, Bytecodes::Code, constantTag)",
"LinkResolver::resolve_static_call_or_null(LinkInfo const&)",
"LinkResolver::resolve_static_call(CallInfo&, LinkInfo const&, bool, JavaThread*)",
"LinkResolver::linktime_resolve_static_method(LinkInfo const&, JavaThread*)",
"InstanceKlass::find_method_index(Array<Method*> const*, Symbol const*, Symbol const*, Klass::OverpassLookupMode, Klass::StaticLookupMode, Klass::PrivateLookupMode)",
"PhaseCCP::PhaseCCP(PhaseIterGVN*)",
"PhaseCCP::analyze()",
"CallNode::Value(PhaseGVN*) const",
"IfNode::Value(PhaseGVN*) const",
"NTarjan::DFS(NTarjan*, VectorSet&, PhaseIdealLoop*, unsigned int*)",
"PhaseIdealLoop::build_loop_late_post_work(Node*, bool)",
"PhaseIdealLoop::compute_lca_of_uses(Node*, Node*, bool)",
"PhaseIdealLoop::has_local_phi_input(Node*)",
"ProjNode::pinned() const",
"RethrowNode::is_CFG() const",
"PhaseIterGVN::PhaseIterGVN(PhaseGVN*)",
"PhaseIterGVN::add_users_to_worklist(Node*)",
"IfNode::Ideal(PhaseGVN*, bool)",
"IfNode::Ideal_common(PhaseGVN*, bool)",
"Unique_Node_List::remove(Node*)",
"NodeHash::hash_find_insert(Node*)",
"PhiNode::hash() const",
"PhaseMacroExpand::expand_macro_nodes()",
"PhiNode::Value(PhaseGVN*) const",
"StorePNode::Opcode() const",
"PhaseRenumberLive::PhaseRenumberLive(PhaseGVN*, Unique_Node_List*, Unique_Node_List*, Phase::PhaseNumber)",
"PredictedCallGenerator::generate(JVMState*)",
"GraphKit::subtype_check_receiver(Node*, ciKlass*, Node**)",
"GraphKit::gen_subtype_check(Node*, Node*)",
"Parse::do_exits()",
"PhaseGVN::transform_no_reclaim(Node*)",
"Type::singleton() const",
"Compile::call_generator(ciMethod*, int, bool, JVMState*, bool, float, ciKlass*, bool)",
"InlineTree::ok_to_inline(ciMethod*, JVMState*, ciCallProfile&, bool&)",
"InlineTree::should_not_inline(ciMethod*, ciMethod*, int, ciCallProfile&)",
"LibraryIntrinsic::generate(JVMState*)",
"bool LibraryCallKit::inline_math_overflow<OverflowSubLNode>(Node*, Node*)",
"SubLNode::Ideal(PhaseGVN*, bool)",
"Compile::optimize_inlining(ciMethod*, ciInstanceKlass*, ciKlass*, ciMethod*, TypeOopPtr const*, bool)",
"ciMethod::find_monomorphic_target(ciInstanceKlass*, ciInstanceKlass*, ciInstanceKlass*, bool)",
"Dependencies::find_unique_concrete_method(InstanceKlass*, Method*, Klass*, Method*)",
"LinkedConcreteMethodFinder::find_witness_anywhere(InstanceKlass*)",
"ClassHierarchyIterator::next()",
"Klass::next_sibling(bool) const",
"ClassLoaderData::is_alive() const",
"Parse::do_one_bytecode()",
"Parse::do_ifnull(BoolTest::mask, Node*)",
"Parse::adjust_map_after_if(BoolTest::mask, Node*, float, Parse::Block*, Parse::Block*)",
"Parse::sharpen_type_after_if(BoolTest::mask, Node*, Type const*, Node*, Type const*)",
"GraphKit::replace_in_map(Node*, Node*)",
"Node::set_req(unsigned int, Node*)",
"ciMethod::get_flow_analysis()",
"ciTypeFlow::do_flow()",
"ciTypeFlow::flow_types()",
"ciTypeFlow::df_flow_types(ciTypeFlow::Block*, bool, ciTypeFlow::StateVector*, ciTypeFlow::JsrSet*)",
"ciTypeFlow::flow_block(ciTypeFlow::Block*, ciTypeFlow::StateVector*, ciTypeFlow::JsrSet*)",
"ciTypeFlow::StateVector::apply_one_bytecode(ciBytecodeStream*)",
"ciTypeFlow::StateVector::do_invoke(ciBytecodeStream*, bool)",
"ciObjectFactory::create_new_metadata(Metadata*)",
"ciMethod::ciMethod(methodHandle const&, ciInstanceKlass*)",
"Mutex::lock(Thread*)",
"_pthread_mutex_firstfit_lock_slow",
"__psynch_mutexwait",
"Compile::identify_useful_nodes(Unique_Node_List&)",
"TypeFunc::make(ciMethod*)",
"TypeTuple::make_domain(ciInstanceKlass*, ciSignature*)",
"TypeInstPtr::xmeet_helper(Type const*) const",
"CompileTask::print(outputStream*, char const*, bool, bool)",
"CompileTask::print_impl(outputStream*, Method*, int, int, bool, int, bool, char const*, bool, bool, long, long)",
"Method::print_short_name(outputStream*) const",
"Symbol::as_klass_external_name() const",
"outputStream::print(char const*, ...)",
"os::vsnprintf(char*, unsigned long, char const*, char*)",
"_vsnprintf",
"__vfprintf",
"Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)",
"Compilation::Compilation(AbstractCompiler*, ciEnv*, ciMethod*, int, BufferBlob*, bool, DirectiveSet*)",
"Compilation::compile_method()",
"Compilation::compile_java_method()",
"Compilation::build_hir()",
"IR::IR(Compilation*, ciMethod*, int)",
"IRScope::IRScope(Compilation*, IRScope*, int, ciMethod*, int, bool)",
"GraphBuilder::GraphBuilder(Compilation*, IRScope*)",
"GraphBuilder::iterate_all_blocks(bool)",
"GraphBuilder::iterate_bytecodes_for_block(int)",
"GraphBuilder::arithmetic_op(ValueType*, Bytecodes::Code, ValueStack*)",
"GraphBuilder::append_with_bci(Instruction*, int)",
"Canonicalizer::do_Op2(Op2*)",
"GraphBuilder::invoke(Bytecodes::Code)",
"GraphBuilder::try_inline(ciMethod*, bool, bool, Bytecodes::Code, Instruction*)",
"GraphBuilder::try_inline_full(ciMethod*, bool, bool, Bytecodes::Code, Instruction*)",
"ciMethod::ensure_method_data()",
"ciMethod::ensure_method_data(methodHandle const&)",
"Method::build_interpreter_method_data(methodHandle const&, JavaThread*)",
"MethodData::allocate(ClassLoaderData*, methodHandle const&, JavaThread*)",
"MethodData::compute_allocation_size_in_bytes(methodHandle const&)",
"MethodData::compute_data_size(BytecodeStream*)",
"MethodData::profile_arguments_for_invoke(methodHandle const&, int)",
"ciSignature::ciSignature(ciKlass*, constantPoolHandle const&, ciSymbol*)",
"ciEnv::get_klass_by_name_impl(ciKlass*, constantPoolHandle const&, ciSymbol*, bool)",
"ttyLocker::release_tty_if_locked()",
"thread_self_trap",
"MemoryBuffer::load(LoadField*)",
"GraphBuilder::setup_start_block(int, BlockBegin*, BlockBegin*, ValueStack*)",
"Compilation::emit_code_body()",
"LIR_Assembler::emit_code(BlockList*)",
"LIR_Assembler::emit_lir_list(LIR_List*)",
"LIR_Assembler::cmove(LIR_Condition, LIR_Opr, LIR_Opr, LIR_Opr, BasicType, LIR_Opr, LIR_Opr)",
"LIR_Assembler::const2reg(LIR_Opr, LIR_Opr, LIR_PatchCode, CodeEmitInfo*)",
"MacroAssembler::mov_immediate64(RegisterImpl const*, unsigned long long)",
"Assembler::movz(RegisterImpl const*, unsigned int, unsigned int)",
"LIR_Assembler::mem2reg(LIR_Opr, LIR_Opr, BasicType, LIR_PatchCode, CodeEmitInfo*, bool)",
"LIR_Assembler::add_debug_info_for_null_check(int, CodeEmitInfo*)",
"LIR_Op2::emit_code(LIR_Assembler*)",
"Compilation::emit_lir()",
"BlockList::iterate_forward(BlockClosure*)",
"non-virtual thunk to LIRGenerator::block_do(BlockBegin*)",
"LIRGenerator::do_If(If*)",
"LIRGenerator::profile_branch(If*, Instruction::Condition)",
"LIRGenerator::do_ProfileInvoke(ProfileInvoke*)",
"ciMethod::has_option_value(CompileCommand, double&)",
"methodHandle::~methodHandle()",
"LinearScan::do_linear_scan()",
"LinearScan::build_intervals()",
"LinearScan::resolve_data_flow()",
"CallRelocation::fix_relocation_after_move(CodeBuffer const*, CodeBuffer*)",
"Relocation::pd_call_destination(unsigned char*)",
"ciEnv::get_method_from_handle(Method*)",
"CompileQueue::get(CompilerThread*)",
"Monitor::wait(long long)",
"__gettimeofday",
"MonitorDeflationThread::monitor_deflation_thread_entry(JavaThread*, JavaThread*)",
"VMThread::run()",
"VMThread::inner_execute(VM_Operation*)",
"SafepointSynchronize::begin()",
"SafepointSynchronize::do_cleanup_tasks()",
"WorkerThreads::run_task(WorkerTask*)",
"SafepointSynchronize::end()",
"SafepointSynchronize::disarm_safepoint()",
"GenericWaitBarrier::disarm()",
"swtch_pri",
"VMThread::evaluate_operation(VM_Operation*)",
"VM_Operation::evaluate()",
"VM_G1CollectForAllocation::doit()",
"G1CollectedHeap::do_collection_pause_at_safepoint(double)",
"G1CollectedHeap::do_collection_pause_at_safepoint_helper(double)",
"G1YoungCollector::collect()",
"G1GCPhaseTimes::print(bool)",
"G1GCPhaseTimes::print_post_evacuate_collection_set(bool) const",
"ReferenceProcessorPhaseTimes::print_all_references(unsigned int, bool) const",
"ReferenceProcessorPhaseTimes::print_phase(ReferenceProcessor::RefProcPhases, unsigned int) const",
"outputStream::print_cr(char const*, ...)",
"G1YoungCollector::evacuate_initial_collection_set(G1ParScanThreadStateSet*, bool)",
"G1RemSet::merge_heap_roots(bool)",
"WorkerThreads::run_task(WorkerTask*, unsigned int)",
"semaphore_signal_trap",
"TaskTerminator::~TaskTerminator()",
"nanov2_free_definite_size",
"G1YoungCollector::post_evacuate_collection_set(G1EvacInfo*, G1ParScanThreadStateSet*)",
"G1CollectedHeap::expand_heap_after_young_collection()",
"G1CollectedHeap::expand(unsigned long, WorkerThreads*, double*)",
"HeapRegionManager::expand_by(unsigned int, WorkerThreads*)",
"HeapRegionManager::expand(unsigned int, unsigned int, WorkerThreads*)",
"G1CollectedHeap::new_heap_region(unsigned int, MemRegion)",
"HeapRegion::HeapRegion(unsigned int, G1BlockOffsetTable*, MemRegion, G1CardSetConfiguration*)",
"HeapRegionRemSet::HeapRegionRemSet(HeapRegion*, G1CardSetConfiguration*)",
"G1CardSet::G1CardSet(G1CardSetConfiguration*, G1CardSetMemoryManager*)",
"ConcurrentHashTable<G1CardSetHashTableConfig, (MEMFLAGS)6>::ConcurrentHashTable(unsigned long, unsigned long, unsigned long, void*)",
"AllocateHeap(unsigned long, MEMFLAGS, AllocFailStrategy::AllocFailEnum)",
"os::malloc(unsigned long, MEMFLAGS, NativeCallStack const&)",
"_malloc_zone_malloc",
"nanov2_malloc",
"nanov2_allocate",
"nanov2_find_block_and_allocate",
"G1CollectedHeap::rebuild_free_region_list()",
"HeapRegionManager::rebuild_free_list(WorkerThreads*)",
"void WeakProcessor::weak_oops_do<G1STWIsAliveClosure, G1KeepAliveClosure>(WorkerThreads*, G1STWIsAliveClosure*, G1KeepAliveClosure*, WeakProcessorTimes*)",
"G1YoungCollector::pre_evacuate_collection_set(G1EvacInfo*, G1ParScanThreadStateSet*)",
"MetaspaceCounters::update_performance_counters()",
"PreservedMarksSet::init(unsigned int)",
"szone_malloc_should_clear",
"small_malloc_should_clear",
"WatcherThread::run()",
"PeriodicTask::real_time_tick(int)",
"PerfLongVariant::sample()",
"StatSamplerTask::task()",
"WatcherThread::sleep() const",
"_pthread_cond_wait",
"WorkerThread::run()",
"G1BatchedTask::work(unsigned int)",
"G1PostEvacuateCollectionSetCleanupTask2::FreeCollectionSetTask::do_work(unsigned int)",
"G1CollectedHeap::par_iterate_regions_array(HeapRegionClosure*, HeapRegionClaimer*, unsigned int const*, unsigned long, unsigned int) const",
"FreeCSetClosure::do_heap_region(HeapRegion*)",
"G1CollectedHeap::free_region(HeapRegion*, FreeRegionList*)",
"HeapRegion::hr_clear(bool)",
"G1CardSet::clear()",
"HeapRegionRemSet::clear_locked(bool)",
"G1DirtyCardQueueSet::num_par_ids()",
"G1RemSetScanState::G1ClearCardTableTask::do_work(unsigned int)",
"G1CMConcurrentMarkingTask::work(unsigned int)",
"G1CMTask::do_marking_step(double, bool, bool)",
"G1CMBitMap::iterate(G1CMBitMapClosure*, MemRegion)",
"G1CMBitMapClosure::do_addr(HeapWordImpl**)",
"G1CMTask::drain_local_queue(bool)",
"void G1CMTask::process_grey_task_entry<true>(G1TaskQueueEntry)",
"ClassLoaderData::oops_do(OopClosure*, int, bool)",
"os::elapsedTime()",
"void OopOopIterateDispatch<G1CMOopClosure>::Table::oop_oop_iterate<InstanceKlass, narrowOop>(G1CMOopClosure*, oopDesc*, Klass*)",
"G1CMTask::make_reference_grey(oopDesc*)",
"G1ConcurrentMark::mark_in_next_bitmap(unsigned int, HeapRegion*, oopDesc*)",
"G1CMBitMap::check_mark(HeapWordImpl**)",
"void InstanceMirrorKlass::oop_oop_iterate<narrowOop, G1CMOopClosure>(oopDesc*, G1CMOopClosure*)",
"void OopOopIterateDispatch<G1CMOopClosure>::Table::oop_oop_iterate<ObjArrayKlass, narrowOop>(G1CMOopClosure*, oopDesc*, Klass*)",
"thread_chkstk_darwin",
"G1CMRootRegionScanTask::work(unsigned int)",
"G1ConcurrentMark::scan_root_region(MemRegion const*, unsigned int)",
"void OopOopIterateDispatch<G1RootRegionScanClosure>::Table::oop_oop_iterate<InstanceKlass, narrowOop>(G1RootRegionScanClosure*, oopDesc*, Klass*)",
"G1EvacuateRegionsBaseTask::work(unsigned int)",
"G1EvacuateRegionsBaseTask::evacuate_live_objects(G1ParScanThreadState*, unsigned int, G1GCPhaseTimes::GCParPhases, G1GCPhaseTimes::GCParPhases)",
"G1ParEvacuateFollowersClosure::do_void()",
"G1ParEvacuateFollowersClosure::offer_termination()",
"TaskTerminator::offer_termination(TerminatorTerminator*)",
"Mutex::lock_without_safepoint_check()",
"SpinPause",
"_pthread_mutex_firstfit_unlock_slow",
"__psynch_mutexdrop",
"G1ParScanThreadState::steal_and_trim_queue(GenericTaskQueueSet<OverflowTaskQueue<ScannerTask, (MEMFLAGS)5, 131072u>, (MEMFLAGS)5>*)",
"G1ParScanThreadState::do_copy_to_survivor_space(G1HeapRegionAttr, oopDesc*, markWord)",
"G1ParScanThreadState::trim_queue_to_threshold(unsigned int)",
"G1BlockOffsetTablePart::update_for_block_work(HeapWordImpl**, HeapWordImpl**)",
"void G1ScanEvacuatedObjClosure::do_oop_work<narrowOop>(narrowOop*)",
"void OopOopIterateBackwardsDispatch<G1ScanEvacuatedObjClosure>::Table::oop_oop_iterate_backwards<InstanceKlass, narrowOop>(G1ScanEvacuatedObjClosure*, oopDesc*, Klass*)",
"G1ParScanThreadState::do_partial_array(PartialArrayScanTask)",
"GenericTaskQueueSet<OverflowTaskQueue<ScannerTask, (MEMFLAGS)5, 131072u>, (MEMFLAGS)5>::steal_best_of_2(unsigned int, ScannerTask&)",
"G1ParScanThreadState::allocate_copy_slow(G1HeapRegionAttr*, oopDesc*, unsigned long, unsigned int, unsigned int)",
"G1EvacuateRegionsTask::scan_roots(G1ParScanThreadState*, unsigned int)",
"G1RemSet::scan_heap_roots(G1ParScanThreadState*, unsigned int, G1GCPhaseTimes::GCParPhases, G1GCPhaseTimes::GCParPhases, bool)",
"G1ScanHRForRegionClosure::do_heap_region(HeapRegion*)",
"G1ScanHRForRegionClosure::scan_heap_roots(HeapRegion*)",
"G1ScanHRForRegionClosure::scan_memregion(unsigned int, MemRegion)",
"void OopOopIterateBoundedDispatch<G1ScanCardClosure>::Table::oop_oop_iterate_bounded<ObjArrayKlass, narrowOop>(G1ScanCardClosure*, oopDesc*, Klass*, MemRegion)",
"G1RootProcessor::evacuate_roots(G1ParScanThreadState*, unsigned int)",
"G1EvacPhaseTimesTracker::~G1EvacPhaseTimesTracker()",
"G1RootProcessor::process_java_roots(G1RootClosures*, G1GCPhaseTimes*, unsigned int)",
"ClassLoaderDataGraph::roots_cld_do(CLDClosure*, CLDClosure*)",
"G1CLDScanClosure::do_cld(ClassLoaderData*)",
"void G1ParCopyClosure<(G1Barrier)1, false>::do_oop_work<oopDesc*>(oopDesc**)",
"Threads::possibly_parallel_oops_do(bool, OopClosure*, CodeBlobClosure*)",
"Threads::possibly_parallel_threads_do(bool, ThreadClosure*)",
"ParallelOopsDoThreadClosure::do_thread(Thread*)",
"JavaThread::oops_do_frames(OopClosure*, CodeBlobClosure*)",
"frame::oops_code_blob_do(OopClosure*, CodeBlobClosure*, DerivedOopClosure*, DerivedPointerIterationMode, RegisterMap const*) const",
"G1CodeBlobClosure::do_code_blob(CodeBlob*)",
"nmethod::oops_do_process_weak(nmethod::OopsDoProcessor*)",
"nmethod::fix_oop_relocations(unsigned char*, unsigned char*, bool)",
"metadata_Relocation::fix_metadata_relocation()",
"ImmutableOopMap::oops_do(frame const*, RegisterMap const*, OopClosure*, DerivedPointerIterationMode) const",
"void OopMapDo<OopClosure, DerivedOopClosure, SkipNullValue>::iterate_oops_do<RegisterMap>(frame const*, RegisterMap const*, ImmutableOopMap const*)",
"void G1ParCopyClosure<(G1Barrier)0, false>::do_oop_work<oopDesc*>(oopDesc**)",
"G1ParScanThreadState::copy_to_survivor_space(G1HeapRegionAttr, oopDesc*, markWord)",
"G1PLABAllocator::allocate_direct_or_new_plab(G1HeapRegionAttr, unsigned long, bool*, unsigned int)",
"frame::oops_interpreted_do(OopClosure*, RegisterMap const*, bool) const",
"ConstantPool::impl_signature_ref_at(int, bool)",
"Method::mask_for(int, InterpreterOopMap*)",
"OopMapCache::lookup(methodHandle const&, int, InterpreterOopMap*)",
"OopMapCacheEntry::fill(methodHandle const&, int)",
"OopMapForCacheEntry::compute_map(Thread*)",
"Chunk::next_chop()",
"Chunk::operator delete(void*)",
"ThreadCritical::ThreadCritical()",
"pthread_self",
"G1RootProcessor::process_vm_roots(G1RootClosures*, G1GCPhaseTimes*, unsigned int)",
"G1GCParPhaseTimesTracker::~G1GCParPhaseTimesTracker()",
"G1ParScanThreadStateSet::state_for_worker(unsigned int)",
"tiny_malloc_should_clear",
"__ulock_wait",
"G1ParScanThreadState::G1ParScanThreadState(G1CollectedHeap*, G1RedirtyCardsQueueSet*, PreservedMarks*, unsigned int, unsigned int, unsigned long, unsigned long, G1EvacFailureRegions*)",
"nanov2_allocate_from_block",
"G1RemSet::scan_collection_set_regions(G1ParScanThreadState*, unsigned int, G1GCPhaseTimes::GCParPhases, G1GCPhaseTimes::GCParPhases, G1GCPhaseTimes::GCParPhases)",
"G1ScanCollectionSetRegionClosure::do_heap_region(HeapRegion*)",
"G1CodeRootSet::nmethods_do(CodeBlobClosure*) const",
"G1EvacPhaseWithTrimTimeTracker::~G1EvacPhaseWithTrimTimeTracker()",
"G1MergeHeapRootsTask::work(unsigned int)",
"G1MergeHeapRootsTask::G1CombinedClosure::do_heap_region(HeapRegion*)",
"G1MergeHeapRootsTask::G1MergeCardSetClosure::do_heap_region(HeapRegion*)",
"HeapRegionClaimer::claim_region(unsigned int)",
"G1GCParPhaseTimesTracker::G1GCParPhaseTimesTracker(G1GCPhaseTimes*, G1GCPhaseTimes::GCParPhases, unsigned int, bool)",
"G1PrepareEvacuationTask::work(unsigned int)",
"HeapRegionManager::par_iterate(HeapRegionClosure*, HeapRegionClaimer*, unsigned int) const",
"G1RebuildFreeListTask::work(unsigned int)",
"G1RebuildRemSetTask::work(unsigned int)",
"G1RebuildRemSetTask::G1RebuildRemSetHeapRegionClosure::do_heap_region(HeapRegion*)",
"G1RebuildRemSetTask::G1RebuildRemSetHeapRegionClosure::rebuild_rem_set_in_region(G1CMBitMap const*, HeapWordImpl**, HeapWordImpl**, HeapRegion*, MemRegion)",
"G1RebuildRemSetTask::G1RebuildRemSetHeapRegionClosure::scan_for_references(oopDesc*, MemRegion)",
"void OopOopIterateDispatch<G1RebuildRemSetClosure>::Table::oop_oop_iterate<InstanceKlass, narrowOop>(G1RebuildRemSetClosure*, oopDesc*, Klass*)",
"void WeakProcessor::Task::work<G1STWIsAliveClosure, G1KeepAliveClosure>(unsigned int, G1STWIsAliveClosure*, G1KeepAliveClosure*)",
"G1KeepAliveClosure::do_oop(oopDesc**)",
"G1STWIsAliveClosure::do_object_b(oopDesc*)",
"OopStorage::BasicParState::increment_num_dead(unsigned long)",
"WeakProcessorParTimeTracker::WeakProcessorParTimeTracker(WeakProcessorTimes*, OopStorageSet::WeakId, unsigned int)",
"WeakProcessorTimes::record_worker_items(unsigned int, OopStorageSet::WeakId, unsigned long, unsigned long)",
];
var initialStacks = [];
var stacks;

var _lastInsertedStack = null;

function a(frameIds, samples) {
  var same = frameIds[0];
  var frames = (same > 0) ? _lastInsertedStack.slice(0,same) : [];

  for (var i = 1, len = frameIds.length; i < len; i++) {
    frames.push(idToFrame[frameIds[i]]);
  }

  _lastInsertedStack = frames;
  initialStacks.push({stackStr: frames.join(";"), samples: samples});
}

var totalSamplesA = 0, totalSamplesB = 0;

function d(frameIds, samples_a, samples_b) {
  var same = frameIds[0];
  var frames = (same > 0) ? _lastInsertedStack.slice(0,same) : [];

  for (var i = 1, len = frameIds.length; i < len; i++) {
    frames.push(idToFrame[frameIds[i]]);
  }

  totalSamplesA += samples_a;
  totalSamplesB += samples_b;

  _lastInsertedStack = frames;
  initialStacks.push({stackStr: frames.join(";"),
                      samples_a: samples_a, samples_b: samples_b});
}

function _extractRegexPrefix(s) {
  let parsed = s.match(/^\/\.\+(.+)\/g$/);
  if (parsed != null) {
    return new RegExp(parsed[1], 'g');
  }
}

function _stringToMaybeRegex(s) {
  if (s == null) return null;
  let parsed = s.match(/^\/(.+)\/$/);
  if (parsed != null)
    return new RegExp(parsed[1], 'g');
  else
    return s;
}

function _makeTransform(type, enabled, what, replacement) {
  let what2 = (typeof(what) == 'string') ? _stringToMaybeRegex(what) : what;
  let what2Str = what2.toString();
  let prefix = (what2 instanceof RegExp) ?
      _extractRegexPrefix(what2Str) : null;
  if (type == 'replace')
    return { type: type, enabled: enabled, what: what2, replacement: replacement, prefix: prefix}
  else
    return { type: type, enabled: enabled, what: what2}
}

var userTransforms = [
_makeTransform('replace', true, /(;tutorial.binary-trees\/bottom-up-tree)+/g, '$1'),
_makeTransform('replace', true, /(;tutorial.binary-trees\/item-check)+/g, '$1'),
_makeTransform('remove', true, 'thread_start', null),
_makeTransform('replace', true, /(seq-reduce;).+;(tutorial.binary-trees\/iterate-trees\/fn--442)/g, '$1$2')
];

function match(string, obj) {
  if (typeof(obj) == 'string') {
    return string.includes(obj);
  } else
    return string.match(obj);
}

function applyReplacement(string, what, replacement, prefix) {
  var s = string;
  var prevMatch = null;
  if (prefix != null) {
    while (true) {
      let match = prefix.exec(string);
      if (match == null) {
        if (prevMatch == null)
          return s;
        else {
          s = string.substring(Math.max(prevMatch.index, 0));
          return s.replace(prefix, replacement);
        }
      } else {
        prevMatch = match;
      }
    }
  }
  return s.replaceAll(what, replacement);
}

function transformStacks() {
  console.time("transformStacks");
  let diff = isDiffgraph;
  var result;
  if (userTransforms.length > 0) {
    var xformedMap = {};
    for (var i = 0; i < initialStacks.length; i++) {
      var stack = initialStacks[i];
      var xformedStr = ";" + stack.stackStr + ";";
      var useIt = true;

      for (var t = 0; t < userTransforms.length; t++) {
        const transform = userTransforms[t];
        if (transform.enabled && transform.what != '') {
          if (transform.type == 'replace') {
            xformedStr = applyReplacement(xformedStr, transform.what,
                                          transform.replacement, transform.prefix);
          } else if (transform.type == 'filter') {
            if (!match(xformedStr, transform.what))
              useIt = false;
          } else if (transform.type == 'remove') {
            if (match(xformedStr, transform.what))
              useIt = false;
          }
        }
        if (!useIt) break;
      }

      xformedStr = xformedStr.substring(1,xformedStr.length-1);

      if (useIt)
        if (diff) {
          let newVal = (xformedMap[xformedStr] || {});
          newVal.samples_a = (newVal.samples_a || 0) + stack.samples_a;
          newVal.samples_b = (newVal.samples_b || 0) + stack.samples_b;
          xformedMap[xformedStr] = newVal;
        } else
          xformedMap[xformedStr] = stack.samples + (xformedMap[xformedStr] || 0);
    }

    var xformedStacks = [];
    for (xformedStr in xformedMap) {
      if (diff) {
        let val = xformedMap[xformedStr];
        xformedStacks.push({stackStr: xformedStr, samples_a: val.samples_a, samples_b: val.samples_b})
      } else
        xformedStacks.push({stackStr: xformedStr, samples: xformedMap[xformedStr]});
    }
    result = xformedStacks;
  } else
    result = initialStacks;

  console.timeEnd("transformStacks");
  return result;
}

console.time("data exec time");

  a([0,0,1,2,],1);
a([0,3,4,5,6,7,8,],1);
a([1,1,9,10,],1);
a([2,11,],3);
a([2,10,],8);
a([0,12,13,14,15,16,17,18,19,20,21,22,23,24,24,25,26,27,28,29,30,31,32,33,34,35,],1);
a([16,36,37,38,16,39,40,14,41,42,],1);
a([17,43,44,45,46,47,48,49,50,51,52,53,54,55,56,],7);
a([31,57,58,46,],1);
a([34,47,48,],5);
a([36,59,],1);
a([36,60,],1);
a([36,61,62,63,],1);
a([36,64,65,66,],2);
a([36,59,67,],1);
a([36,62,68,],1);
a([36,68,],7);
a([36,69,],3);
a([37,70,71,],1);
a([37,72,],1);
a([38,73,74,],3);
a([40,75,],2);
a([40,76,],2);
a([40,77,],1);
a([37,76,],7);
a([38,78,],1);
a([39,79,],10);
a([40,78,],2);
a([40,74,],1);
a([38,80,],37);
a([39,80,],1);
a([40,81,],5);
a([38,82,],2);
a([39,83,],5);
a([38,76,],1);
a([39,76,],17);
a([40,78,],1);
a([41,79,],13);
a([42,78,],5);
a([42,74,],2);
a([40,80,],145);
a([41,9,84,85,86,87,],2);
a([41,80,88,],7);
a([43,74,],3);
a([42,81,],1);
a([40,82,],15);
a([41,83,],38);
a([40,76,],17);
a([41,82,83,],1);
a([41,76,],26);
a([42,78,],2);
a([43,79,],30);
a([44,78,],13);
a([44,74,],13);
a([42,80,],167);
a([43,9,84,85,86,89,90,91,92,93,94,],1);
a([47,95,],1);
a([43,80,88,],2);
a([44,81,],4);
a([42,82,],37);
a([43,83,],43);
a([43,96,],18);
a([42,76,],21);
a([43,76,],30);
a([44,78,],1);
a([45,79,],29);
a([46,78,],20);
a([46,74,],9);
a([44,80,],182);
a([45,80,88,],4);
a([46,81,],3);
a([44,82,],23);
a([45,83,],41);
a([45,96,],7);
a([44,76,],19);
a([45,82,82,],1);
a([45,76,],27);
a([46,78,],2);
a([47,79,],21);
a([48,78,],18);
a([48,74,],12);
a([46,80,],150);
a([47,9,84,85,86,97,],1);
a([47,80,88,],3);
a([48,81,],2);
a([46,82,],25);
a([47,83,],38);
a([47,96,],7);
a([46,76,],21);
a([47,76,],18);
a([48,78,],1);
a([49,79,],20);
a([50,78,],19);
a([50,74,],9);
a([48,80,],149);
a([49,9,84,85,98,99,100,101,],1);
a([52,86,89,90,91,92,93,94,102,],1);
a([49,80,],1);
a([50,88,],1);
a([50,81,],7);
a([48,82,],24);
a([49,83,],44);
a([49,96,],11);
a([48,76,],25);
a([49,76,],34);
a([50,78,],3);
a([51,79,],21);
a([52,78,],10);
a([52,74,],12);
a([50,80,],134);
a([51,9,84,85,86,89,90,92,],1);
a([51,80,88,],2);
a([52,81,],3);
a([50,82,],37);
a([51,83,],32);
a([51,96,],10);
a([51,103,],1);
a([50,76,],16);
a([51,76,],23);
a([52,78,79,],14);
a([54,78,],14);
a([54,74,],8);
a([52,80,],111);
a([53,9,84,85,86,95,97,],1);
a([57,97,],1);
a([53,80,88,],1);
a([54,81,],8);
a([52,82,],45);
a([53,83,],46);
a([53,96,],6);
a([52,76,],11);
a([53,76,],17);
a([54,78,],4);
a([55,79,],9);
a([56,78,],14);
a([56,74,],8);
a([54,80,],62);
a([55,9,84,85,86,89,90,104,105,106,107,108,],1);
a([55,80,81,],1);
a([54,82,],17);
a([55,83,],29);
a([55,96,],6);
a([54,76,],9);
a([55,76,],5);
a([56,78,79,],2);
a([58,78,],7);
a([58,74,],2);
a([56,80,],10);
a([56,82,],8);
a([57,83,],8);
a([57,96,],3);
a([37,77,],28);
a([38,77,],5);
a([39,70,],1);
a([40,71,],2);
a([40,109,],1);
a([40,70,71,],2);
a([42,70,],1);
a([41,109,],1);
a([41,81,],4);
a([39,72,81,],1);
a([39,77,],142);
a([40,9,84,85,86,],1);
a([40,110,111,112,113,114,115,],1);
a([40,70,70,71,],2);
a([42,81,],1);
a([40,77,],23);
a([41,70,],5);
a([42,71,],3);
a([43,74,],4);
a([42,109,],3);
a([42,70,],3);
a([43,71,],5);
a([44,70,],1);
a([44,74,],2);
a([43,109,],3);
a([43,81,],6);
a([41,72,73,],2);
a([42,81,],2);
a([41,116,],1);
a([41,117,],3);
a([41,77,],154);
a([42,77,],20);
a([43,70,],4);
a([44,71,],5);
a([45,74,],3);
a([44,70,71,],5);
a([46,74,],1);
a([45,81,],1);
a([44,81,],11);
a([43,72,73,],1);
a([44,81,],2);
a([43,77,],182);
a([44,77,],27);
a([45,70,],1);
a([46,71,],6);
a([47,74,],6);
a([46,70,71,],6);
a([48,74,],3);
a([47,109,],1);
a([45,72,],1);
a([46,73,],1);
a([46,81,],1);
a([45,116,],1);
a([45,77,],171);
a([46,70,70,71,],1);
a([46,77,],22);
a([47,70,],7);
a([48,71,],4);
a([49,74,],7);
a([48,70,71,],8);
a([50,74,],1);
a([49,81,],1);
a([47,72,],1);
a([48,73,],1);
a([48,81,],1);
a([47,116,],4);
a([47,77,],161);
a([48,9,84,85,86,89,90,118,],1);
a([52,87,],1);
a([48,70,70,71,],1);
a([48,77,],26);
a([49,70,],5);
a([50,71,],3);
a([51,74,],3);
a([50,70,71,],5);
a([51,109,],1);
a([51,81,],1);
a([49,72,],1);
a([50,81,],1);
a([49,116,],1);
a([49,77,],138);
a([50,9,84,85,86,89,90,91,92,93,],1);
a([50,70,70,71,],1);
a([50,77,],21);
a([51,70,],4);
a([52,71,],3);
a([53,74,],3);
a([52,70,],1);
a([53,71,],1);
a([54,74,],1);
a([51,116,],2);
a([51,77,],148);
a([52,9,84,85,86,89,90,119,],1);
a([52,77,],14);
a([53,70,],5);
a([54,71,],5);
a([55,74,],2);
a([54,109,],1);
a([54,70,71,],4);
a([56,74,],1);
a([53,72,73,],1);
a([54,81,],2);
a([53,77,],73);
a([54,9,84,85,86,89,90,104,],1);
a([61,105,120,121,122,],1);
a([54,70,70,71,],2);
a([54,77,],9);
a([55,70,],1);
a([56,71,],1);
a([57,74,],1);
a([56,70,71,],1);
a([58,74,],1);
a([57,109,],1);
a([55,116,],1);
a([55,77,],19);
a([56,9,84,85,123,],1);
a([56,77,],3);
a([31,124,125,70,],1);
a([34,71,70,],1);
a([35,74,],1);
a([29,44,45,46,47,48,69,76,76,76,76,76,76,76,78,79,78,],1);
a([42,76,76,80,],1);
a([44,82,83,],2);
a([44,76,76,78,],1);
a([47,79,],2);
a([46,80,],3);
a([46,82,83,],2);
a([46,76,76,],1);
a([48,78,79,74,],1);
a([48,80,],11);
a([49,80,81,],1);
a([48,82,],2);
a([48,76,76,],3);
a([50,78,79,],3);
a([52,78,],1);
a([52,74,],1);
a([50,80,],35);
a([51,9,84,85,89,],1);
a([51,80,88,],1);
a([52,81,],2);
a([50,82,],3);
a([51,83,],8);
a([50,76,],7);
a([51,76,],9);
a([52,78,79,],6);
a([54,78,],2);
a([54,74,],3);
a([52,80,],96);
a([53,80,81,],1);
a([52,82,],7);
a([53,83,],21);
a([52,76,],8);
a([53,76,],17);
a([54,78,],1);
a([55,79,],18);
a([56,78,],3);
a([56,74,],2);
a([54,80,],110);
a([55,9,84,85,86,89,90,91,92,93,94,126,],1);
a([55,80,88,],2);
a([57,74,],1);
a([56,81,],5);
a([54,82,],20);
a([55,83,],46);
a([55,96,],4);
a([54,76,],15);
a([55,76,],9);
a([56,78,79,],9);
a([58,78,],21);
a([58,74,],4);
a([56,80,],16);
a([57,9,84,85,86,87,],1);
a([60,123,],1);
a([56,82,],13);
a([57,83,],12);
a([57,96,],10);
a([35,77,77,77,77,70,70,71,],1);
a([39,77,77,77,],1);
a([42,77,77,],2);
a([44,77,70,70,71,],1);
a([45,77,],3);
a([46,77,],2);
a([47,77,],11);
a([48,77,],3);
a([49,70,71,74,],1);
a([50,70,81,],1);
a([49,77,],24);
a([50,77,],3);
a([51,70,71,],1);
a([52,70,71,],2);
a([51,72,73,],1);
a([51,117,],1);
a([51,77,],75);
a([52,9,84,85,123,],1);
a([52,70,70,71,],1);
a([52,77,],17);
a([53,70,],4);
a([54,71,],3);
a([54,109,],1);
a([54,70,],1);
a([55,109,],1);
a([53,77,],121);
a([54,9,84,85,86,89,90,91,],1);
a([54,77,],15);
a([55,70,],9);
a([56,71,],3);
a([57,74,],2);
a([56,70,],2);
a([57,71,],6);
a([58,74,],2);
a([57,109,],3);
a([58,127,],1);
a([57,81,],2);
a([55,72,81,],3);
a([55,116,],2);
a([55,117,],2);
a([55,77,],39);
a([56,77,],5);
a([57,70,81,],5);
a([18,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,80,],2);
a([37,80,],1);
a([38,88,74,],1);
a([36,76,80,],4);
a([37,82,],2);
a([38,83,],6);
a([37,76,],2);
a([38,80,],6);
a([39,80,109,],1);
a([39,75,],1);
a([38,82,83,],1);
a([38,76,],1);
a([39,78,79,78,],2);
a([41,74,],1);
a([40,81,],1);
a([39,80,],4);
a([40,80,],1);
a([41,88,74,],1);
a([39,82,],2);
a([40,83,],1);
a([39,76,],1);
a([40,78,79,],1);
a([42,74,],1);
a([40,82,],2);
a([41,83,],1);
a([40,128,129,],1);
a([37,128,],1);
a([18,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,77,],3);
a([35,77,72,81,],1);
a([36,77,],11);
a([37,9,84,85,86,89,90,91,92,130,131,],1);
a([37,70,],1);
a([38,70,],1);
a([39,81,],1);
a([37,77,],5);
a([38,70,70,],1);
a([38,117,132,],1);
a([38,77,],2);
a([39,9,84,85,98,],1);
a([39,70,],1);
a([40,71,],1);
a([40,70,],1);
a([40,75,],1);
a([39,72,],2);
a([39,77,],5);
a([40,70,71,],1);
a([40,133,],1);
a([0,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,],1);
a([2,154,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,155,],1);
a([3,156,157,158,159,160,161,162,163,164,165,166,],1);
a([5,167,168,167,169,167,170,171,172,173,10,],1);
a([13,174,175,176,177,38,38,28,29,30,31,32,33,34,35,],1);
a([16,178,40,44,45,46,47,179,180,181,182,183,184,185,186,187,188,],1);
a([13,189,190,136,191,137,138,192,140,193,194,195,196,197,198,199,],1);
a([13,200,16,201,202,203,204,205,206,44,45,46,47,207,44,45,46,47,48,208,209,210,211,212,213,214,215,],1);
a([13,216,217,136,137,138,139,140,218,219,220,221,222,223,],1);
a([15,224,225,226,227,228,229,230,231,232,233,234,235,236,230,237,238,239,240,241,242,243,244,245,],1);
a([15,246,247,248,249,173,250,251,252,159,160,253,254,255,256,257,258,],1);
a([18,259,260,261,262,263,264,265,266,266,267,268,269,270,271,270,272,273,10,],1);
a([22,274,264,265,275,275,276,277,269,278,173,279,280,281,282,283,284,],1);
a([29,285,286,287,288,289,290,291,291,292,293,294,294,294,295,296,297,298,299,300,301,302,303,304,],1);
a([25,305,306,307,289,290,308,309,158,310,311,312,313,314,315,316,317,318,],1);
a([18,319,320,321,322,264,265,305,306,323,289,290,324,325,326,327,328,328,329,173,279,330,331,],1);
a([24,332,332,333,334,335,336,337,338,288,289,290,291,291,292,293,294,294,339,339,340,341,342,343,344,345,346,312,313,314,315,148,149,150,347,348,349,],1);
a([30,350,337,351,352,353,354,355,356,357,358,359,360,361,],1);
a([29,350,337,338,288,289,290,291,291,292,293,294,294,339,339,340,341,342,343,344,345,346,312,313,314,315,316,317,318,],1);
a([15,362,363,158,310,311,312,313,314,315,148,149,150,347,348,102,],1);
a([13,364,365,366,367,368,369,370,371,372,373,374,375,376,],1);
a([5,377,378,379,224,225,226,227,228,230,380,381,382,383,384,385,210,211,212,386,],1);
a([7,387,158,310,311,312,313,314,315,148,149,150,347,348,349,],1);
a([7,388,388,158,310,311,312,313,314,315,148,149,150,347,348,349,389,],1);
a([5,390,391,392,173,279,330,393,394,310,311,312,313,314,395,396,],1);
a([8,397,398,399,400,401,402,],1);
a([5,403,404,405,406,407,408,136,137,138,138,409,342,343,344,345,346,312,410,],1);
a([11,411,412,412,413,414,415,416,417,418,419,420,421,188,188,188,188,188,188,188,],1);
a([2,422,423,424,425,],1);
a([2,426,423,424,427,428,],1);
a([2,429,430,158,310,311,312,313,314,315,148,149,150,347,348,349,389,],1);
a([0,431,432,433,434,435,436,437,438,439,440,],5);
a([9,441,],1);
a([7,442,443,],1);
a([4,444,445,446,447,448,449,450,451,452,453,],1);
a([11,454,455,],2);
a([13,456,457,],1);
a([10,458,459,],1);
a([10,460,461,462,],1);
a([12,463,464,],1);
a([13,465,],1);
a([12,466,467,],2);
a([12,468,],1);
a([12,469,],1);
a([10,470,471,],1);
a([10,472,473,],1);
a([11,474,],1);
a([11,475,476,],1);
a([12,477,],1);
a([11,478,],2);
a([12,479,480,],1);
a([12,481,482,],1);
a([11,483,],1);
a([12,484,],2);
a([12,485,],1);
a([11,486,],1);
a([11,487,],2);
a([12,488,],2);
a([11,489,490,],1);
a([11,491,476,],1);
a([11,492,493,],2);
a([11,494,],1);
a([11,87,],1);
a([11,495,],1);
a([10,496,497,],1);
a([11,498,],1);
a([12,499,500,],1);
a([12,501,502,503,],1);
a([12,504,505,506,507,],1);
a([11,508,509,510,],1);
a([10,511,512,513,514,515,516,],1);
a([12,517,518,519,520,521,522,523,],1);
a([9,524,525,526,527,528,529,530,526,527,528,529,530,526,527,531,532,533,534,535,],1);
a([10,536,],1);
a([11,537,538,539,],1);
a([10,540,541,542,],1);
a([12,543,544,545,546,547,],1);
a([11,548,549,],1);
a([10,550,551,552,553,],1);
a([13,554,],1);
a([13,555,],1);
a([13,556,557,],1);
a([12,541,543,558,],1);
a([10,559,560,442,561,],1);
a([10,562,541,543,563,564,565,566,],1);
a([10,567,568,569,570,571,572,573,574,575,571,572,573,574,575,571,572,573,574,533,534,576,577,578,579,282,331,580,],1);
a([10,581,582,583,],1);
a([12,584,],1);
a([10,551,552,554,],1);
a([13,585,],1);
a([12,555,586,587,],1);
a([12,556,557,588,],1);
a([12,589,],1);
a([12,590,],1);
a([11,541,],1);
a([12,543,],1);
a([10,591,592,],2);
a([10,541,543,],1);
a([12,593,594,563,564,595,],1);
a([12,596,597,],1);
a([10,598,541,543,599,],1);
a([13,600,],1);
a([10,601,548,549,],1);
a([9,526,527,528,529,530,526,527,528,529,530,602,526,527,528,529,530,526,527,528,529,530,526,527,528,529,530,602,526,527,528,529,530,602,603,604,],1);
a([27,605,606,607,],1);
a([14,602,526,527,528,529,530,608,609,610,],1);
a([20,526,527,528,529,530,526,527,528,529,530,602,526,527,528,529,530,526,527,528,529,530,611,612,613,],1);
a([15,602,526,527,528,529,530,526,527,528,529,530,526,527,528,529,530,614,615,616,617,618,619,620,],1);
a([21,602,526,527,528,529,621,622,623,624,625,565,626,],1);
a([22,602,526,527,528,529,530,608,608,609,627,628,629,630,631,632,633,533,534,535,634,635,636,637,638,],1);
a([9,548,639,],1);
a([9,640,641,642,],1);
a([7,643,644,645,646,],1);
a([9,647,648,649,650,],1);
a([7,651,652,653,654,655,656,657,658,659,660,661,662,663,],1);
a([17,664,665,666,659,660,664,615,616,617,],1);
a([20,667,668,669,670,671,672,673,],1);
a([18,533,534,535,634,635,674,675,676,677,],1);
a([17,678,],1);
a([15,679,102,],1);
a([11,680,681,682,683,684,685,686,],1);
a([14,687,688,],1);
a([14,689,],1);
a([11,690,691,692,693,694,],2);
a([14,695,696,697,],1);
a([12,698,699,],2);
a([13,700,],1);
a([10,512,517,518,519,520,701,702,522,],1);
a([7,703,535,634,635,674,165,166,389,],1);
a([6,704,705,439,706,],1);
a([5,707,438,439,440,],1);
a([4,708,709,710,711,712,115,],2);
a([6,713,714,715,716,],1);
a([6,717,718,719,720,721,722,723,724,725,726,727,648,649,650,],1);
a([12,728,729,730,731,],1);
a([15,115,],1);
a([13,732,733,],1);
a([13,712,731,],1);
a([14,115,],1);
a([12,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,],1);
a([13,750,751,730,731,],3);
a([16,115,],1);
a([13,730,115,],1);
a([13,752,730,731,],2);
a([15,115,],2);
a([12,753,],1);
a([12,754,],1);
a([12,755,744,745,746,756,757,],1);
a([4,758,759,],1);
a([6,760,],1);
a([6,761,760,442,561,],1);
a([5,762,438,763,],1);
a([7,439,706,],3);
a([8,440,],8);
a([6,561,],1);
a([4,764,],1);
a([5,765,766,767,768,560,442,443,],1);
a([9,769,770,771,],1);
a([11,772,771,],1);
a([12,131,773,],1);
a([6,774,87,],3);
a([5,775,776,777,],5);
a([8,778,],2);
a([9,779,],6);
a([10,780,],1);
a([11,781,],1);
a([11,782,561,],1);
a([11,783,],6);
a([12,784,],1);
a([13,785,],5);
a([14,786,],1);
a([9,780,],1);
a([10,784,],1);
a([10,787,],1);
a([10,783,],6);
a([11,784,785,],4);
a([10,788,],2);
a([9,783,],1);
a([8,789,],1);
a([7,778,],1);
a([7,779,],3);
a([8,780,],2);
a([9,781,],1);
a([9,783,],6);
a([10,784,785,786,],1);
a([10,785,],1);
a([7,780,],3);
a([5,790,791,],1);
a([7,792,],2);
a([6,792,],1);
a([5,793,794,795,],1);
a([8,796,797,],1);
a([10,438,439,440,],15);
a([12,763,637,638,],4);
a([10,798,637,638,],34);
a([10,799,],2);
a([10,800,801,],3);
a([10,716,],2);
a([8,802,803,],7);
a([9,804,],22);
a([10,805,],1);
a([10,803,],91);
a([11,805,],1);
a([11,806,],25);
a([11,807,],17);
a([12,806,],81);
a([10,808,806,],1);
a([9,809,],1);
a([8,804,],5);
a([9,803,],16);
a([10,810,],1);
a([10,806,],3);
a([10,807,],4);
a([11,806,],15);
a([9,808,],1);
a([6,811,812,813,],1);
a([9,814,],1);
a([10,815,816,],1);
a([7,817,818,],1);
a([8,819,820,821,781,822,],1);
a([13,804,],1);
a([14,803,],1);
a([9,823,824,825,826,827,828,829,830,831,],1);
a([14,832,833,834,835,810,836,],1);
a([13,837,838,],1);
a([14,839,840,841,842,843,844,845,846,],1);
a([8,847,848,560,442,443,],1);
a([9,834,],1);
a([6,849,744,745,746,756,850,851,],1);
a([7,852,744,745,746,747,748,853,],1);
a([6,854,767,855,],1);
a([9,856,828,829,830,],1);
a([9,857,560,442,443,],3);
a([5,858,767,],1);
a([7,859,860,],2);
a([7,861,],2);
a([6,862,],1);
a([5,863,864,],1);
a([5,865,],1);
a([6,560,442,561,],1);
a([5,866,864,867,868,],8);
a([9,869,],9);
a([10,870,],50);
a([8,869,],3);
a([5,115,],61);
a([5,871,],3);
a([6,872,],2);
a([6,873,],4);
a([6,874,],1);
a([6,875,560,442,443,],1);
a([6,876,],1);


console.timeEnd("data exec time");


function makeTreeNode() {
  if (isDiffgraph)
    return {self_samples_a: 0, self_samples_b: 0, self_delta: 0,
            total_samples_a: 0, total_samples_b: 0, total_delta: 0,
            delta_abs: 0, children: {}};
  else
    return {self: 0, total: 0, children: {}};
}

function getChildNode(node, childTitle) {
  var children = node.children;
  var child = children[childTitle];
  if (child == undefined) {
    child = makeTreeNode();
    children[childTitle] = child;
  }
  return child;
}

function parseStacksToTreeSimple(stacks, treeRoot) {
  console.time("parseStacksToTreeSimple");
  var depth = 0;
  for (var i = 0, len = stacks.length; i < len; i++) {
    var stack = stacks[i];
    var stackframes = stack.stackStr.split(";");
    var stackLen = stackframes.length;
    depth = Math.max(depth, stackLen);
    var node = treeRoot;
    if (reverseGraph) {
      for (var j = stackLen-1; j >= 0; j--) {
        var stackframe = stackframes[j];
        node.total += stack.samples;
        node = getChildNode(node, stackframe);
      }
    } else {
      for (var j = 0; j < stackLen; j++) {
        var stackframe = stackframes[j];
        node.total += stack.samples;
        node = getChildNode(node, stackframe);
      }
    }
    node.total += stack.samples;
    node.self += stack.samples;
  }
  console.timeEnd("parseStacksToTreeSimple");
  return depth;
}

function parseStacksToTreeDiffgraph(stacks, treeRoot) {
  console.time("parseStacksToTreeDiffgraph");
  var depth = 0;

  for (var i = 0, len = stacks.length; i < len; i++) {
    var stack = stacks[i];
    var stackframes = stack.stackStr.split(";");
    var stackLen = stackframes.length;
    depth = Math.max(depth, stackLen);
    var node = treeRoot;

    var samplesA = stack.samples_a;
    var samplesB = stack.samples_b;
    if (normalizeDiff) samplesB = Math.round(samplesB * b_scale_factor);
    var delta = samplesB - samplesA;


    if (reverseGraph) {
      for (var j = stackLen-1; j >= 0; j--) {
        var stackframe = stackframes[j];
        node.total_samples_a += samplesA;
        node.total_samples_b += samplesB;
        node.total_delta += delta;
        node.delta_abs += Math.abs(delta);
        node = getChildNode(node, stackframe);
      }
    } else {
      for (var j = 0; j < stackLen; j++) {
        var stackframe = stackframes[j];
        node.total_samples_a += samplesA;
        node.total_samples_b += samplesB;
        node.total_delta += delta;
        node.delta_abs += Math.abs(delta);
        node = getChildNode(node, stackframe);
      }
    }
    node.self_samples_a += samplesA;
    node.self_samples_b += samplesB;
    node.self_delta += delta;
    node.total_samples_a += samplesA;
    node.total_samples_b += samplesB;
    node.total_delta += delta;
    node.delta_abs += Math.abs(delta);
  }
  console.timeEnd("parseStacksToTreeDiffgraph");
  return depth;
}

function parseStacksToTree(stacks, treeRoot) {
  if (isDiffgraph)
    return parseStacksToTreeDiffgraph(stacks, treeRoot);
  else
    return parseStacksToTreeSimple(stacks, treeRoot);
}

const palette = {
  green: "#50e150",
  aqua: "#50bebe",
  orange: "#e17d00",
  yellow: "#c8c83c",
  red: "#e15a5a",
  clojure_green: "#91dc51",
  clojure_blue: "#8fb5fe",
};

function getColor(title) {
  if (title.endsWith("_[j]")) {
    return palette.green;
  } else if (title.endsWith("_[i]")) {
    return palette.aqua;
  } else if (title.endsWith("_[k]")) {
    return palette.orange;
  } else if (title.includes("::") || title.startsWith("-[") || title.startsWith("+[")) {
    return palette.yellow;
  } else if (title.includes("/")) { // Clojure (will only work after unmunging)
    return palette.clojure_blue;
  } else if (title.includes(".")) { // Java (if it has a dot and is not Clojure)
    return palette.clojure_green;
  } else return palette.red;
}

function decToHex(n) {
  var hex = n.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function getDiffColor(isRed, intensity) {
  return "hsl(" + ((isRed) ? 0 : 220) + ",100%," + Math.round(90 - intensity * 30) + "%)";
  // return "hsl(" + ((isRed) ? 0 : 220) + "," + Math.round(100 * intensity) + "%, 60%)";
}

function scaleColorMap(colorMap, intensity) {
  return '#' + decToHex(intensity * colorMap.red) +
    decToHex(intensity * colorMap.green) + decToHex(intensity * colorMap.blue);
}

var stacks, tree, levels, depth;

var smallestPixelsPerSample, minPixelsPerFrame = 0.25, minSamplesToShow;

function generateLevelsSimple(levels, node, title, level, x, minSamplesToShow) {
  var left = x;

  levels[level] = levels[level] || [];
  if (node.total >= minSamplesToShow) {
    levels[level].push({left: left, width: node.total, color: getColor(title),
                        title: title});

    left += node.self;

    let children = Object.entries(node.children);
    if (sortByNameRadio.checked)
      children.sort((a, b) => a[0].localeCompare(b[0]));
    else
      children.sort((a, b) => b[1].total - a[1].total);

    for (let i in children) {
      let title = children[i][0];
      let child = children[i][1];
      generateLevelsSimple(levels, child, title, level+1, left, minSamplesToShow);
      left += child.total;
    }
  }
}

function generateLevelsDiffgraph(levels, node, title, level, x, minSamplesToShow) {
  var left = x;

  levels[level] = levels[level] || [];
  if (node.delta_abs >= minSamplesToShow) {
    var change = (node.total_samples_a == 0) ? 1.0 : node.total_delta / node.total_samples_a;
    var color = getDiffColor((node.total_delta > 0), Math.min(Math.abs(change), 1.0));
    levels[level].push({left: left, width: node.delta_abs,
                        self_samples_a: node.self_samples_a,
                        self_samples_b: node.self_samples_b,
                        self_delta: node.self_delta,
                        total_samples_a: node.total_samples_a,
                        total_samples_b: node.total_samples_b,
                        total_delta: node.total_delta,
                        color: color,
                        title: title});

    left += Math.abs(node.self_delta);

    let children = Object.entries(node.children);
    if (sortByNameRadio.checked)
      children.sort((a, b) => a[0].localeCompare(b[0]));
    else
      children.sort((a, b) => b[1].delta_abs - a[1].delta_abs);

    for (let i in children) {
      let title = children[i][0];
      let child = children[i][1];
      generateLevelsDiffgraph(levels, child, title, level+1, left, minSamplesToShow);
      left += child.delta_abs;
    }
  }
}

function generateLevels(levels, node, title, level, x, minSamplesToShow) {
  if (isDiffgraph)
    generateLevelsDiffgraph(levels, node, title, level, x, minSamplesToShow);
  else
    generateLevelsSimple(levels, node, title, level, x, minSamplesToShow);
}

function refreshData() {
  if (isDiffgraph && normalizeDiff)
    b_scale_factor = totalSamplesA / totalSamplesB;

  stacks = transformStacks();

  tree = makeTreeNode();

  depth = parseStacksToTree(stacks, tree);
  smallestPixelsPerSample = canvasWidth / (tree.total || tree.delta_abs);
  minSamplesToShow = minPixelsPerFrame / smallestPixelsPerSample;

  levels = [];
  generateLevels(levels, tree, "all", 0, 0, minSamplesToShow);
  depth = levels.length;
}

refreshData();

var canvasHeight;

function initCanvas() {
  canvasHeight = (depth + 1) * 16;
  canvas.style.width = canvasWidth + 'px';
  canvas.width = canvasWidth * (devicePixelRatio || 1);
  canvas.height = canvasHeight * (devicePixelRatio || 1);
  if (devicePixelRatio) c.scale(devicePixelRatio, devicePixelRatio);
  c.font = document.body.style.font;
}

initCanvas();
isNormalizedDiv.style.display = isDiffgraph ? 'inherit' : 'none';
if (graphTitle == "")
  titleDiv.style.display = 'none';
else
  graphTitleSpan.innerText = graphTitle;


var highlightPattern = null, currentRootFrame, currentRootLevel, currentFrameUnderCursor, currentLevelUnderCursor, px;

function render(newRootFrame, newLevel) {
  console.time("render");
  // Background
  var gradient = c.createLinearGradient(0, 0, 0, canvasHeight);
  gradient.addColorStop(0.05, "#eeeeee");
  gradient.addColorStop(0.95, "#eeeeb0");
  c.fillStyle = gradient;
  c.fillRect(0, 0, canvasWidth, canvasHeight);

  currentRootFrame = newRootFrame || levels[0][0];
  currentRootLevel = newLevel || 0;
  px = canvasWidth / currentRootFrame.width;

  const marked = [];

  function mark(f) {
    return marked[f.left] >= f.width || (marked[f.left] = f.width);
  }

  function totalMarked() {
    let total = 0;
    let left = 0;
    for (let x in marked) {
      if (+x >= left) {
        total += marked[x];
        left = +x + marked[x];
      }
    }
    return total;
  }

  const x0 = currentRootFrame.left;
  const x1 = x0 + currentRootFrame.width;

  function drawFrame(f, y, alpha) {
    if (f.left < x1 && f.left + f.width > x0) {
      c.fillStyle = highlightPattern && f.title.match(highlightPattern) && mark(f) ? '#ee00ee' : f.color;
      c.fillRect((f.left - x0) * px, y, f.width * px, 15);

      if (f.width * px >= 21) {
        const chars = Math.floor(f.width * px / 7);
        const title = f.title.length <= chars ? f.title : f.title.substring(0, chars - 2) + '..';
        c.fillStyle = '#000000';
        c.fillText(title, Math.max(f.left - x0, 0) * px + 3, y + 12, f.width * px - 6);
      }

      if (alpha) {
        c.fillStyle = 'rgba(255, 255, 255, 0.5)';
        c.fillRect((f.left - x0) * px, y, f.width * px, 15);
      }
    }
  }

  for (let h = 0; h < levels.length; h++) {
    const y = reverseGraph ? h * 16 : canvasHeight - (h + 1) * 16;
    const frames = levels[h];
    for (let i = 0; i < frames.length; i++) {
      if (frames[i].width >= minSamplesToShow)
        drawFrame(frames[i], y, h < currentRootLevel);
    }
  }

  if (highlightPattern != null) {
    matchContainer.style.display = 'inherit';
    matchedLabel.textContent = pct(totalMarked(), currentRootFrame.width) + '%';
  } else
    matchContainer.style.display = 'none';
  console.timeEnd("render");
}

render();

function round2dig(n) {
  return Math.round(n * 100) / 100;
}

function ratioToPct(n) {
  return ((n > 0) ? "+" : "") + (n * 100).toFixed(2) + "%";
}

function findFrame(frames, x) {
  let left = 0;
  let right = frames.length - 1;

  while (left <= right) {
    const mid = (left + right) >>> 1;
    const f = frames[mid];

    if (f.left > x) {
      right = mid - 1;
    } else if (f.left + f.width <= x) {
      left = mid + 1;
    } else {
      return f;
    }
  }

  if (frames[left] && (frames[left].left - x) * px < 0.5) return frames[left];
  if (frames[right] && (x - (frames[right].left + frames[right].width)) * px < 0.5) return frames[right];

  return null;
}

canvas.onmousemove = function() {
  const h = Math.floor((reverseGraph ? event.offsetY : (canvasHeight - event.offsetY)) / 16);
  currentLevelUnderCursor = h;
  if (h >= 0 && h < levels.length) {
    const f = findFrame(levels[h], event.offsetX / px + currentRootFrame.left);
    currentFrameUnderCursor = f;
    if (f && f.width >= minSamplesToShow) {
      hl.style.left = (Math.max(f.left - currentRootFrame.left, 0) * px + canvas.offsetLeft) + 'px';
      hl.style.width = (Math.min(f.width, currentRootFrame.width) * px) + 'px';
      hl.style.top = ((reverseGraph ? h * 16 : canvasHeight - (h + 1) * 16) + canvas.offsetTop) + 'px';
      // hl.firstChild.textContent = f.title;
      hl.style.display = 'block';
      if (isDiffgraph) {
        var rel_change = (f.total_samples_a == 0) ? 1.0 : f.total_delta / f.total_samples_a;
        var total_change = f.total_delta / tree.total_samples_a;
        canvas.title = `${f.title}\n(${samples(f.total_delta, true)}, ${ratioToPct(rel_change)} self, ${ratioToPct(total_change)} total)`;
        // , self_samples_a: ${f.self_samples_a}, self_samples_b: ${f.self_samples_b},  self_delta: ${f.self_delta},  total_samples_a: ${f.total_samples_a},  total_samples_b: ${f.total_samples_b}, total_delta: ${f.total_delta})`;
      } else
        canvas.title = f.title + '\n(' + samples(f.width) + ', ' + pct(f.width, levels[0][0].width) + '%)';
      canvas.style.cursor = 'pointer';
      status.textContent = 'Function: ' + canvas.title;
      status.style['max-width'] = (canvas.offsetWidth - 150) + 'px';
      return;
    }
  }
  canvas.onmouseout();
}

canvas.onclick = function () {
  if (currentFrameUnderCursor && currentFrameUnderCursor != currentRootFrame) {
    render(currentFrameUnderCursor, currentLevelUnderCursor);
    canvas.onmousemove();
  }
}

canvas.onmouseout = function() {
  hl.style.display = 'none';
  status.textContent = '\xa0';
  canvas.title = '';
  canvas.style.cursor = '';
  currentLevelUnderCursor = -1;
  currentFrameUnderCursor = null;
}

function samples(n, add_plus) {
  return (add_plus && n > 0 ? "+" : "") + (n === 1 ? '1 sample' : n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')) + ' samples';
}

function pct(a, b) {
  return a >= b ? '100' : (100 * a / b).toFixed(2);
}

//// Configuration panel

function highlightApply() {
  const pattern = highlightInput.value;
  highlightPattern = (pattern == "") ? null : _stringToMaybeRegex(pattern);
  render(currentRootFrame, currentRootLevel);
}

function highlightClear() {
  highlightPattern = null;
  render(currentRootFrame, currentRootLevel);
}

function userTransformsSwap(idx1, idx2) {
  const swap = userTransforms[idx1];
  userTransforms[idx1] = userTransforms[idx2];
  userTransforms[idx2] = swap;
}

function addNewTransformParameterized(type, what, replacement) {
  syncTransformsModelWithUI();
  userTransforms.push(_makeTransform(type, true, what, replacement));
  redrawTransformsSection();
}

function addNewTransform() {
  addNewTransformParameterized(newTransformType.value, "", "");
}

function deleteTransform(originator) {
  syncTransformsModelWithUI();
  userTransforms.splice(originator.internalId, 1);
  redrawTransformsSection();
}

function cloneTransform(originator) {
  syncTransformsModelWithUI();
  const idx = originator.internalId;
  userTransforms.splice(idx+1, 0, Object.assign({}, userTransforms[idx]));
  redrawTransformsSection();
}

function moveTransformUp(originator) {
  const idx = originator.internalId;
  if (idx == 0) return;
  syncTransformsModelWithUI();
  userTransformsSwap(idx-1, idx);
  redrawTransformsSection();
}

function moveTransformDown(originator) {
  const idx = originator.internalId;
  if (idx == userTransforms.length-1) return;
  syncTransformsModelWithUI();
  userTransformsSwap(idx, idx+1);
  redrawTransformsSection();
}

function refreshAfterEnabledToggle() {
  syncTransformsModelWithUI();
  redrawTransformsSection();
}

function oneByClass(container, classname) {
  return container.getElementsByClassName(classname)[0];
}

function syncTransformsModelWithUI() {
  for (var i = 0; i < transformsContainer.children.length; i++) {
    const el = transformsContainer.children[i];
    const model = userTransforms[i];
    userTransforms[i] =
      _makeTransform(model.type, oneByClass(el, 'chkEnabled').checked,
                     oneByClass(el, 'what').value,
                     model.type == 'replace' ? oneByClass(el, 'replacement').value : null);
  }
}

function redrawTransformsSection() {
  transformsContainer.innerHTML = "";
  for (var i = 0; i < userTransforms.length; i++) {
    const transform = userTransforms[i];
    var newEl = (transform.type == 'replace') ?
        transformReplaceTemplate.cloneNode(true) :
        transformFilterTemplate.cloneNode(true);
    newEl.style = '';
    newEl.internalId = i;

    const what = transform.what;
    if (typeof(what) == 'string')
      oneByClass(newEl, 'what').value = what;
    else
      oneByClass(newEl, 'what').value = what.toString().match(/^(\/.+\/)g?$/)[1];

    if (transform.type == 'replace')
      oneByClass(newEl, 'replacement').value = transform.replacement;
    else if (transform.type == 'remove')
      oneByClass(newEl, 'label').textContent = "Remove:";
    oneByClass(newEl, 'chkEnabled').checked = transform.enabled;

    oneByClass(newEl, 'chkEnabled').internalId = i;
    oneByClass(newEl, 'btnMoveUp').internalId = i;
    oneByClass(newEl, 'btnMoveDown').internalId = i;
    oneByClass(newEl, 'btnClone').internalId = i;
    oneByClass(newEl, 'btnDelete').internalId = i;
    transformsContainer.appendChild(newEl);
  }
}

redrawTransformsSection();

function scrollToTopOrBottom() {
  window.scrollTo(0, reverseGraph ? 0 : document.body.scrollHeight);
}

scrollToTopOrBottom();

function applyConfiguration() {
  console.time("apply config");
  minPixelsPerFrame = minFrameWidthInPx.value || 0.25;
  normalizeDiff = isNormalized.checked;
  let reverseChanged = (reverseGraph != isReversedInput.checked);
  reverseGraph = isReversedInput.checked;
  syncTransformsModelWithUI();
  refreshData();
  initCanvas();
  render();
  if (reverseChanged)
    scrollToTopOrBottom();
  console.timeEnd("apply config");
}

function toggleSidebarVisibility() {
  sidebarVisible = !sidebarVisible;
  updateSidebarState();
  applyConfiguration();
}


// Context menu implementation was taken from https://github.com/heapoverride/context-js
// and modified to suit our needs. Licensed Under MIT License, author: @UnrealSec
class ContextMenu {
  constructor(container, items) {
    this.container = container;
    this.dom = null;
    this.shown = false;
    this.root = true;
    this.items = items;
    this._onclick = e => {
      if (this.dom && e.target != this.dom &&
          e.target.parentElement != this.dom &&
          !e.target.classList.contains('item') &&
          !e.target.parentElement.classList.contains('item')) {
        this.hide();
      }
    };
    this._oncontextmenu = e => {
      if (e.target != this.dom &&
          e.target.parentElement != this.dom &&
          !e.target.classList.contains('item') &&
          !e.target.parentElement.classList.contains('item') &&
          currentFrameUnderCursor) {
        e.preventDefault();
        this.hide();
        this.frame = currentFrameUnderCursor;
        this.show(e.clientX, e.clientY);
      }
    };
    this._onblur = e => { this.hide(); };
  }
  getMenuDom() {
    const menu = document.createElement('div');
    menu.classList.add('context');
    for (const item of this.items)
      menu.appendChild(this.itemToDomEl(item));
    return menu;
  }
  itemToDomEl(data) {
    const item = document.createElement('div');
    if (data === null) {
      item.classList = 'separator';
      return item;
    }
    if (data.hasOwnProperty('color') && /^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(data.color.toString())) {
      item.style.cssText = `color: ${data.color}`;
    }
    item.classList.add('item');

    const label = document.createElement('span');
    label.classList = 'label';
    label.innerText = data.hasOwnProperty('text') ? data['text'].toString() : '';
    item.appendChild(label);

    if (data.hasOwnProperty('disabled') && data['disabled'])
      item.classList.add('disabled');
    else
      item.classList.add('enabled');

    item.addEventListener('click', e => {
      if (item.classList.contains('disabled')) return;
      if (data.hasOwnProperty('onclick') && typeof data['onclick'] === 'function') {
        const event = {handled: false, item: item, label: label, items: this.items, data: data};
        data['onclick'](event, this.frame);
        if (!event.handled)
          this.hide();
      } else {
        this.hide();
      }
    });
    return item;
  }
  hide() {
    if (this.dom && this.shown) {
      this.shown = false;
      this.container.removeChild(this.dom);
    }
  }
  show(x, y) {
    this.dom = this.getMenuDom();
    this.dom.style.visibility = 'hidden';
    this.dom.style.left = `${x}px`;
    this.dom.style.top = `${y}px`;
    this.shown = true;
    this.container.appendChild(this.dom);

    if (this.dom.offsetWidth + x > document.body.clientWidth)
      this.dom.style.left = `${x-this.dom.offsetWidth}px`;
    if (this.dom.offsetHeight + y > document.body.clientHeight)
      this.dom.style.top = `${y-this.dom.offsetHeight}px`;
    this.dom.style.visibility = 'visible';
  }

  install() {
    this.container.addEventListener('contextmenu', this._oncontextmenu, false);
    this.container.addEventListener('keydown', this._oncontextmenu_keydown);
    this.container.addEventListener('click', this._onclick);
    window.addEventListener('blur', this._onblur);
  }
}

function escapeRegex(regexString) {
  return regexString.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function menuHighlight(e, frame) {
  let rx = escapeRegex(frame.title);
  highlightInput.value = "/^" + rx + "$/";
  highlightApply();
}

function menuCopyAsText(e, frame) {
  navigator.clipboard.writeText(frame.title);
}

function menuCopyAsRegex(e, frame) {
  let rx = escapeRegex(frame.title);
  navigator.clipboard.writeText(rx);
}

function menuFilterContaining(e, frame) {
  addNewTransformParameterized('filter', ";" + frame.title + ";", "");
  applyConfiguration();
}

function menuRemoveContaining(e, frame) {
  addNewTransformParameterized('remove', ";" + frame.title + ";", "");
  applyConfiguration();
}

function menuHideFramesAbove(e, frame) {
  let rx = escapeRegex(frame.title);
  addNewTransformParameterized('replace', "/(;" + rx + ";).*/", "$1");
  applyConfiguration();
}

function menuHideFramesBelow(e, frame) {
  let rx = escapeRegex(frame.title);
  addNewTransformParameterized('replace', "/.+(" + rx + ";)/", ";$1");
  applyConfiguration();
}

function menuCollapseRecursive(e, frame) {
  let rx = escapeRegex(frame.title);
  addNewTransformParameterized('replace', "/;(" + rx + ";)+/", ";$1");
  applyConfiguration();
}

function menuCollapseRecursiveWithGaps(e, frame) {
  let rx = escapeRegex(frame.title);
  addNewTransformParameterized('replace', "/;(" + rx + ";).*\\1/", ";$1");
  applyConfiguration();
}

const ctxMenuData = [
  {text: 'Highlight', onclick: menuHighlight },
  {text: 'Copy as text', onclick: menuCopyAsText },
  {text: 'Copy as regex', onclick: menuCopyAsRegex },
  null,
  {text: 'Filter containing stacks', onclick: menuFilterContaining },
  {text: 'Remove containing stacks', onclick: menuRemoveContaining },
  {text: 'Hide frames above', onclick: menuHideFramesAbove },
  {text: 'Hide frames below', onclick: menuHideFramesBelow },
  null,
  {text: 'Collapse recursive', onclick: menuCollapseRecursive },
  {text: 'Collapse recursive (with gaps)', onclick: menuCollapseRecursiveWithGaps},
];

const ctxMenu = new ContextMenu(document.getElementById('canvasDiv'), ctxMenuData);
ctxMenu.install();

    </script>
  </body>
</html>
